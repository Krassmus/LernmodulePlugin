{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport Path from \"./path.js\";\nimport Polygon from \"./polygon.js\";\nexport default class Voronoi {\n  constructor(delaunay, [xmin, ymin, xmax, ymax] = [0, 0, 960, 500]) {\n    if (!((xmax = +xmax) >= (xmin = +xmin)) || !((ymax = +ymax) >= (ymin = +ymin))) throw new Error(\"invalid bounds\");\n    this.delaunay = delaunay;\n    this._circumcenters = new Float64Array(delaunay.points.length * 2);\n    this.vectors = new Float64Array(delaunay.points.length * 2);\n    this.xmax = xmax, this.xmin = xmin;\n    this.ymax = ymax, this.ymin = ymin;\n\n    this._init();\n  }\n\n  update() {\n    this.delaunay.update();\n\n    this._init();\n\n    return this;\n  }\n\n  _init() {\n    const {\n      delaunay: {\n        points,\n        hull,\n        triangles\n      },\n      vectors\n    } = this;\n    let bx, by; // lazily computed barycenter of the hull\n    // Compute circumcenters.\n\n    const circumcenters = this.circumcenters = this._circumcenters.subarray(0, triangles.length / 3 * 2);\n\n    for (let i = 0, j = 0, n = triangles.length, x, y; i < n; i += 3, j += 2) {\n      const t1 = triangles[i] * 2;\n      const t2 = triangles[i + 1] * 2;\n      const t3 = triangles[i + 2] * 2;\n      const x1 = points[t1];\n      const y1 = points[t1 + 1];\n      const x2 = points[t2];\n      const y2 = points[t2 + 1];\n      const x3 = points[t3];\n      const y3 = points[t3 + 1];\n      const dx = x2 - x1;\n      const dy = y2 - y1;\n      const ex = x3 - x1;\n      const ey = y3 - y1;\n      const ab = (dx * ey - dy * ex) * 2;\n\n      if (Math.abs(ab) < 1e-9) {\n        // For a degenerate triangle, the circumcenter is at the infinity, in a\n        // direction orthogonal to the halfedge and away from the “center” of\n        // the diagram <bx, by>, defined as the hull’s barycenter.\n        if (bx === undefined) {\n          bx = by = 0;\n\n          for (const i of hull) bx += points[i * 2], by += points[i * 2 + 1];\n\n          bx /= hull.length, by /= hull.length;\n        }\n\n        const a = 1e9 * Math.sign((bx - x1) * ey - (by - y1) * ex);\n        x = (x1 + x3) / 2 - a * ey;\n        y = (y1 + y3) / 2 + a * ex;\n      } else {\n        const d = 1 / ab;\n        const bl = dx * dx + dy * dy;\n        const cl = ex * ex + ey * ey;\n        x = x1 + (ey * bl - dy * cl) * d;\n        y = y1 + (dx * cl - ex * bl) * d;\n      }\n\n      circumcenters[j] = x;\n      circumcenters[j + 1] = y;\n    } // Compute exterior cell rays.\n\n\n    let h = hull[hull.length - 1];\n    let p0,\n        p1 = h * 4;\n    let x0,\n        x1 = points[2 * h];\n    let y0,\n        y1 = points[2 * h + 1];\n    vectors.fill(0);\n\n    for (let i = 0; i < hull.length; ++i) {\n      h = hull[i];\n      p0 = p1, x0 = x1, y0 = y1;\n      p1 = h * 4, x1 = points[2 * h], y1 = points[2 * h + 1];\n      vectors[p0 + 2] = vectors[p1] = y0 - y1;\n      vectors[p0 + 3] = vectors[p1 + 1] = x1 - x0;\n    }\n  }\n\n  render(context) {\n    const buffer = context == null ? context = new Path() : undefined;\n    const {\n      delaunay: {\n        halfedges,\n        inedges,\n        hull\n      },\n      circumcenters,\n      vectors\n    } = this;\n    if (hull.length <= 1) return null;\n\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\n      const j = halfedges[i];\n      if (j < i) continue;\n      const ti = Math.floor(i / 3) * 2;\n      const tj = Math.floor(j / 3) * 2;\n      const xi = circumcenters[ti];\n      const yi = circumcenters[ti + 1];\n      const xj = circumcenters[tj];\n      const yj = circumcenters[tj + 1];\n\n      this._renderSegment(xi, yi, xj, yj, context);\n    }\n\n    let h0,\n        h1 = hull[hull.length - 1];\n\n    for (let i = 0; i < hull.length; ++i) {\n      h0 = h1, h1 = hull[i];\n      const t = Math.floor(inedges[h1] / 3) * 2;\n      const x = circumcenters[t];\n      const y = circumcenters[t + 1];\n      const v = h0 * 4;\n\n      const p = this._project(x, y, vectors[v + 2], vectors[v + 3]);\n\n      if (p) this._renderSegment(x, y, p[0], p[1], context);\n    }\n\n    return buffer && buffer.value();\n  }\n\n  renderBounds(context) {\n    const buffer = context == null ? context = new Path() : undefined;\n    context.rect(this.xmin, this.ymin, this.xmax - this.xmin, this.ymax - this.ymin);\n    return buffer && buffer.value();\n  }\n\n  renderCell(i, context) {\n    const buffer = context == null ? context = new Path() : undefined;\n\n    const points = this._clip(i);\n\n    if (points === null || !points.length) return;\n    context.moveTo(points[0], points[1]);\n    let n = points.length;\n\n    while (points[0] === points[n - 2] && points[1] === points[n - 1] && n > 1) n -= 2;\n\n    for (let i = 2; i < n; i += 2) {\n      if (points[i] !== points[i - 2] || points[i + 1] !== points[i - 1]) context.lineTo(points[i], points[i + 1]);\n    }\n\n    context.closePath();\n    return buffer && buffer.value();\n  }\n\n  *cellPolygons() {\n    const {\n      delaunay: {\n        points\n      }\n    } = this;\n\n    for (let i = 0, n = points.length / 2; i < n; ++i) {\n      const cell = this.cellPolygon(i);\n      if (cell) cell.index = i, yield cell;\n    }\n  }\n\n  cellPolygon(i) {\n    const polygon = new Polygon();\n    this.renderCell(i, polygon);\n    return polygon.value();\n  }\n\n  _renderSegment(x0, y0, x1, y1, context) {\n    let S;\n\n    const c0 = this._regioncode(x0, y0);\n\n    const c1 = this._regioncode(x1, y1);\n\n    if (c0 === 0 && c1 === 0) {\n      context.moveTo(x0, y0);\n      context.lineTo(x1, y1);\n    } else if (S = this._clipSegment(x0, y0, x1, y1, c0, c1)) {\n      context.moveTo(S[0], S[1]);\n      context.lineTo(S[2], S[3]);\n    }\n  }\n\n  contains(i, x, y) {\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return false;\n    return this.delaunay._step(i, x, y) === i;\n  }\n\n  *neighbors(i) {\n    const ci = this._clip(i);\n\n    if (ci) for (const j of this.delaunay.neighbors(i)) {\n      const cj = this._clip(j); // find the common edge\n\n\n      if (cj) loop: for (let ai = 0, li = ci.length; ai < li; ai += 2) {\n        for (let aj = 0, lj = cj.length; aj < lj; aj += 2) {\n          if (ci[ai] === cj[aj] && ci[ai + 1] === cj[aj + 1] && ci[(ai + 2) % li] === cj[(aj + lj - 2) % lj] && ci[(ai + 3) % li] === cj[(aj + lj - 1) % lj]) {\n            yield j;\n            break loop;\n          }\n        }\n      }\n    }\n  }\n\n  _cell(i) {\n    const {\n      circumcenters,\n      delaunay: {\n        inedges,\n        halfedges,\n        triangles\n      }\n    } = this;\n    const e0 = inedges[i];\n    if (e0 === -1) return null; // coincident point\n\n    const points = [];\n    let e = e0;\n\n    do {\n      const t = Math.floor(e / 3);\n      points.push(circumcenters[t * 2], circumcenters[t * 2 + 1]);\n      e = e % 3 === 2 ? e - 2 : e + 1;\n      if (triangles[e] !== i) break; // bad triangulation\n\n      e = halfedges[e];\n    } while (e !== e0 && e !== -1);\n\n    return points;\n  }\n\n  _clip(i) {\n    // degenerate case (1 valid point: return the box)\n    if (i === 0 && this.delaunay.hull.length === 1) {\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\n    }\n\n    const points = this._cell(i);\n\n    if (points === null) return null;\n    const {\n      vectors: V\n    } = this;\n    const v = i * 4;\n    return this._simplify(V[v] || V[v + 1] ? this._clipInfinite(i, points, V[v], V[v + 1], V[v + 2], V[v + 3]) : this._clipFinite(i, points));\n  }\n\n  _clipFinite(i, points) {\n    const n = points.length;\n    let P = null;\n    let x0,\n        y0,\n        x1 = points[n - 2],\n        y1 = points[n - 1];\n\n    let c0,\n        c1 = this._regioncode(x1, y1);\n\n    let e0,\n        e1 = 0;\n\n    for (let j = 0; j < n; j += 2) {\n      x0 = x1, y0 = y1, x1 = points[j], y1 = points[j + 1];\n      c0 = c1, c1 = this._regioncode(x1, y1);\n\n      if (c0 === 0 && c1 === 0) {\n        e0 = e1, e1 = 0;\n        if (P) P.push(x1, y1);else P = [x1, y1];\n      } else {\n        let S, sx0, sy0, sx1, sy1;\n\n        if (c0 === 0) {\n          if ((S = this._clipSegment(x0, y0, x1, y1, c0, c1)) === null) continue;\n          [sx0, sy0, sx1, sy1] = S;\n        } else {\n          if ((S = this._clipSegment(x1, y1, x0, y0, c1, c0)) === null) continue;\n          [sx1, sy1, sx0, sy0] = S;\n          e0 = e1, e1 = this._edgecode(sx0, sy0);\n          if (e0 && e1) this._edge(i, e0, e1, P, P.length);\n          if (P) P.push(sx0, sy0);else P = [sx0, sy0];\n        }\n\n        e0 = e1, e1 = this._edgecode(sx1, sy1);\n        if (e0 && e1) this._edge(i, e0, e1, P, P.length);\n        if (P) P.push(sx1, sy1);else P = [sx1, sy1];\n      }\n    }\n\n    if (P) {\n      e0 = e1, e1 = this._edgecode(P[0], P[1]);\n      if (e0 && e1) this._edge(i, e0, e1, P, P.length);\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\n    }\n\n    return P;\n  }\n\n  _clipSegment(x0, y0, x1, y1, c0, c1) {\n    // for more robustness, always consider the segment in the same order\n    const flip = c0 < c1;\n    if (flip) [x0, y0, x1, y1, c0, c1] = [x1, y1, x0, y0, c1, c0];\n\n    while (true) {\n      if (c0 === 0 && c1 === 0) return flip ? [x1, y1, x0, y0] : [x0, y0, x1, y1];\n      if (c0 & c1) return null;\n      let x,\n          y,\n          c = c0 || c1;\n      if (c & 0b1000) x = x0 + (x1 - x0) * (this.ymax - y0) / (y1 - y0), y = this.ymax;else if (c & 0b0100) x = x0 + (x1 - x0) * (this.ymin - y0) / (y1 - y0), y = this.ymin;else if (c & 0b0010) y = y0 + (y1 - y0) * (this.xmax - x0) / (x1 - x0), x = this.xmax;else y = y0 + (y1 - y0) * (this.xmin - x0) / (x1 - x0), x = this.xmin;\n      if (c0) x0 = x, y0 = y, c0 = this._regioncode(x0, y0);else x1 = x, y1 = y, c1 = this._regioncode(x1, y1);\n    }\n  }\n\n  _clipInfinite(i, points, vx0, vy0, vxn, vyn) {\n    let P = Array.from(points),\n        p;\n    if (p = this._project(P[0], P[1], vx0, vy0)) P.unshift(p[0], p[1]);\n    if (p = this._project(P[P.length - 2], P[P.length - 1], vxn, vyn)) P.push(p[0], p[1]);\n\n    if (P = this._clipFinite(i, P)) {\n      for (let j = 0, n = P.length, c0, c1 = this._edgecode(P[n - 2], P[n - 1]); j < n; j += 2) {\n        c0 = c1, c1 = this._edgecode(P[j], P[j + 1]);\n        if (c0 && c1) j = this._edge(i, c0, c1, P, j), n = P.length;\n      }\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\n      P = [this.xmin, this.ymin, this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax];\n    }\n\n    return P;\n  }\n\n  _edge(i, e0, e1, P, j) {\n    while (e0 !== e1) {\n      let x, y;\n\n      switch (e0) {\n        case 0b0101:\n          e0 = 0b0100;\n          continue;\n        // top-left\n\n        case 0b0100:\n          e0 = 0b0110, x = this.xmax, y = this.ymin;\n          break;\n        // top\n\n        case 0b0110:\n          e0 = 0b0010;\n          continue;\n        // top-right\n\n        case 0b0010:\n          e0 = 0b1010, x = this.xmax, y = this.ymax;\n          break;\n        // right\n\n        case 0b1010:\n          e0 = 0b1000;\n          continue;\n        // bottom-right\n\n        case 0b1000:\n          e0 = 0b1001, x = this.xmin, y = this.ymax;\n          break;\n        // bottom\n\n        case 0b1001:\n          e0 = 0b0001;\n          continue;\n        // bottom-left\n\n        case 0b0001:\n          e0 = 0b0101, x = this.xmin, y = this.ymin;\n          break;\n        // left\n      } // Note: this implicitly checks for out of bounds: if P[j] or P[j+1] are\n      // undefined, the conditional statement will be executed.\n\n\n      if ((P[j] !== x || P[j + 1] !== y) && this.contains(i, x, y)) {\n        P.splice(j, 0, x, y), j += 2;\n      }\n    }\n\n    return j;\n  }\n\n  _project(x0, y0, vx, vy) {\n    let t = Infinity,\n        c,\n        x,\n        y;\n\n    if (vy < 0) {\n      // top\n      if (y0 <= this.ymin) return null;\n      if ((c = (this.ymin - y0) / vy) < t) y = this.ymin, x = x0 + (t = c) * vx;\n    } else if (vy > 0) {\n      // bottom\n      if (y0 >= this.ymax) return null;\n      if ((c = (this.ymax - y0) / vy) < t) y = this.ymax, x = x0 + (t = c) * vx;\n    }\n\n    if (vx > 0) {\n      // right\n      if (x0 >= this.xmax) return null;\n      if ((c = (this.xmax - x0) / vx) < t) x = this.xmax, y = y0 + (t = c) * vy;\n    } else if (vx < 0) {\n      // left\n      if (x0 <= this.xmin) return null;\n      if ((c = (this.xmin - x0) / vx) < t) x = this.xmin, y = y0 + (t = c) * vy;\n    }\n\n    return [x, y];\n  }\n\n  _edgecode(x, y) {\n    return (x === this.xmin ? 0b0001 : x === this.xmax ? 0b0010 : 0b0000) | (y === this.ymin ? 0b0100 : y === this.ymax ? 0b1000 : 0b0000);\n  }\n\n  _regioncode(x, y) {\n    return (x < this.xmin ? 0b0001 : x > this.xmax ? 0b0010 : 0b0000) | (y < this.ymin ? 0b0100 : y > this.ymax ? 0b1000 : 0b0000);\n  }\n\n  _simplify(P) {\n    if (P && P.length > 4) {\n      for (let i = 0; i < P.length; i += 2) {\n        const j = (i + 2) % P.length,\n              k = (i + 4) % P.length;\n\n        if (P[i] === P[j] && P[j] === P[k] || P[i + 1] === P[j + 1] && P[j + 1] === P[k + 1]) {\n          P.splice(j, 2), i -= 2;\n        }\n      }\n\n      if (!P.length) P = null;\n    }\n\n    return P;\n  }\n\n}","map":{"version":3,"sources":["/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/vue/node_modules/d3-delaunay/src/voronoi.js"],"names":["Path","Polygon","Voronoi","constructor","delaunay","xmin","ymin","xmax","ymax","Error","_circumcenters","Float64Array","points","length","vectors","_init","update","hull","triangles","bx","by","circumcenters","subarray","i","j","n","x","y","t1","t2","t3","x1","y1","x2","y2","x3","y3","dx","dy","ex","ey","ab","Math","abs","undefined","a","sign","d","bl","cl","h","p0","p1","x0","y0","fill","render","context","buffer","halfedges","inedges","ti","floor","tj","xi","yi","xj","yj","_renderSegment","h0","h1","t","v","p","_project","value","renderBounds","rect","renderCell","_clip","moveTo","lineTo","closePath","cellPolygons","cell","cellPolygon","index","polygon","S","c0","_regioncode","c1","_clipSegment","contains","_step","neighbors","ci","cj","loop","ai","li","aj","lj","_cell","e0","e","push","V","_simplify","_clipInfinite","_clipFinite","P","e1","sx0","sy0","sx1","sy1","_edgecode","_edge","flip","c","vx0","vy0","vxn","vyn","Array","from","unshift","splice","vx","vy","Infinity","k"],"mappings":"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","sourcesContent":["import Path from \"./path.js\";\nimport Polygon from \"./polygon.js\";\n\nexport default class Voronoi {\n  constructor(delaunay, [xmin, ymin, xmax, ymax] = [0, 0, 960, 500]) {\n    if (!((xmax = +xmax) >= (xmin = +xmin)) || !((ymax = +ymax) >= (ymin = +ymin))) throw new Error(\"invalid bounds\");\n    this.delaunay = delaunay;\n    this._circumcenters = new Float64Array(delaunay.points.length * 2);\n    this.vectors = new Float64Array(delaunay.points.length * 2);\n    this.xmax = xmax, this.xmin = xmin;\n    this.ymax = ymax, this.ymin = ymin;\n    this._init();\n  }\n  update() {\n    this.delaunay.update();\n    this._init();\n    return this;\n  }\n  _init() {\n    const {delaunay: {points, hull, triangles}, vectors} = this;\n    let bx, by; // lazily computed barycenter of the hull\n\n    // Compute circumcenters.\n    const circumcenters = this.circumcenters = this._circumcenters.subarray(0, triangles.length / 3 * 2);\n    for (let i = 0, j = 0, n = triangles.length, x, y; i < n; i += 3, j += 2) {\n      const t1 = triangles[i] * 2;\n      const t2 = triangles[i + 1] * 2;\n      const t3 = triangles[i + 2] * 2;\n      const x1 = points[t1];\n      const y1 = points[t1 + 1];\n      const x2 = points[t2];\n      const y2 = points[t2 + 1];\n      const x3 = points[t3];\n      const y3 = points[t3 + 1];\n\n      const dx = x2 - x1;\n      const dy = y2 - y1;\n      const ex = x3 - x1;\n      const ey = y3 - y1;\n      const ab = (dx * ey - dy * ex) * 2;\n\n      if (Math.abs(ab) < 1e-9) {\n        // For a degenerate triangle, the circumcenter is at the infinity, in a\n        // direction orthogonal to the halfedge and away from the “center” of\n        // the diagram <bx, by>, defined as the hull’s barycenter.\n        if (bx === undefined) {\n          bx = by = 0;\n          for (const i of hull) bx += points[i * 2], by += points[i * 2 + 1];\n          bx /= hull.length, by /= hull.length;\n        }\n        const a = 1e9 * Math.sign((bx - x1) * ey - (by - y1) * ex);\n        x = (x1 + x3) / 2 - a * ey;\n        y = (y1 + y3) / 2 + a * ex;\n      } else {\n        const d = 1 / ab;\n        const bl = dx * dx + dy * dy;\n        const cl = ex * ex + ey * ey;\n        x = x1 + (ey * bl - dy * cl) * d;\n        y = y1 + (dx * cl - ex * bl) * d;\n      }\n      circumcenters[j] = x;\n      circumcenters[j + 1] = y;\n    }\n\n    // Compute exterior cell rays.\n    let h = hull[hull.length - 1];\n    let p0, p1 = h * 4;\n    let x0, x1 = points[2 * h];\n    let y0, y1 = points[2 * h + 1];\n    vectors.fill(0);\n    for (let i = 0; i < hull.length; ++i) {\n      h = hull[i];\n      p0 = p1, x0 = x1, y0 = y1;\n      p1 = h * 4, x1 = points[2 * h], y1 = points[2 * h + 1];\n      vectors[p0 + 2] = vectors[p1] = y0 - y1;\n      vectors[p0 + 3] = vectors[p1 + 1] = x1 - x0;\n    }\n  }\n  render(context) {\n    const buffer = context == null ? context = new Path : undefined;\n    const {delaunay: {halfedges, inedges, hull}, circumcenters, vectors} = this;\n    if (hull.length <= 1) return null;\n    for (let i = 0, n = halfedges.length; i < n; ++i) {\n      const j = halfedges[i];\n      if (j < i) continue;\n      const ti = Math.floor(i / 3) * 2;\n      const tj = Math.floor(j / 3) * 2;\n      const xi = circumcenters[ti];\n      const yi = circumcenters[ti + 1];\n      const xj = circumcenters[tj];\n      const yj = circumcenters[tj + 1];\n      this._renderSegment(xi, yi, xj, yj, context);\n    }\n    let h0, h1 = hull[hull.length - 1];\n    for (let i = 0; i < hull.length; ++i) {\n      h0 = h1, h1 = hull[i];\n      const t = Math.floor(inedges[h1] / 3) * 2;\n      const x = circumcenters[t];\n      const y = circumcenters[t + 1];\n      const v = h0 * 4;\n      const p = this._project(x, y, vectors[v + 2], vectors[v + 3]);\n      if (p) this._renderSegment(x, y, p[0], p[1], context);\n    }\n    return buffer && buffer.value();\n  }\n  renderBounds(context) {\n    const buffer = context == null ? context = new Path : undefined;\n    context.rect(this.xmin, this.ymin, this.xmax - this.xmin, this.ymax - this.ymin);\n    return buffer && buffer.value();\n  }\n  renderCell(i, context) {\n    const buffer = context == null ? context = new Path : undefined;\n    const points = this._clip(i);\n    if (points === null || !points.length) return;\n    context.moveTo(points[0], points[1]);\n    let n = points.length;\n    while (points[0] === points[n-2] && points[1] === points[n-1] && n > 1) n -= 2;\n    for (let i = 2; i < n; i += 2) {\n      if (points[i] !== points[i-2] || points[i+1] !== points[i-1])\n        context.lineTo(points[i], points[i + 1]);\n    }\n    context.closePath();\n    return buffer && buffer.value();\n  }\n  *cellPolygons() {\n    const {delaunay: {points}} = this;\n    for (let i = 0, n = points.length / 2; i < n; ++i) {\n      const cell = this.cellPolygon(i);\n      if (cell) cell.index = i, yield cell;\n    }\n  }\n  cellPolygon(i) {\n    const polygon = new Polygon;\n    this.renderCell(i, polygon);\n    return polygon.value();\n  }\n  _renderSegment(x0, y0, x1, y1, context) {\n    let S;\n    const c0 = this._regioncode(x0, y0);\n    const c1 = this._regioncode(x1, y1);\n    if (c0 === 0 && c1 === 0) {\n      context.moveTo(x0, y0);\n      context.lineTo(x1, y1);\n    } else if (S = this._clipSegment(x0, y0, x1, y1, c0, c1)) {\n      context.moveTo(S[0], S[1]);\n      context.lineTo(S[2], S[3]);\n    }\n  }\n  contains(i, x, y) {\n    if ((x = +x, x !== x) || (y = +y, y !== y)) return false;\n    return this.delaunay._step(i, x, y) === i;\n  }\n  *neighbors(i) {\n    const ci = this._clip(i);\n    if (ci) for (const j of this.delaunay.neighbors(i)) {\n      const cj = this._clip(j);\n      // find the common edge\n      if (cj) loop: for (let ai = 0, li = ci.length; ai < li; ai += 2) {\n        for (let aj = 0, lj = cj.length; aj < lj; aj += 2) {\n          if (ci[ai] === cj[aj]\n              && ci[ai + 1] === cj[aj + 1]\n              && ci[(ai + 2) % li] === cj[(aj + lj - 2) % lj]\n              && ci[(ai + 3) % li] === cj[(aj + lj - 1) % lj]) {\n            yield j;\n            break loop;\n          }\n        }\n      }\n    }\n  }\n  _cell(i) {\n    const {circumcenters, delaunay: {inedges, halfedges, triangles}} = this;\n    const e0 = inedges[i];\n    if (e0 === -1) return null; // coincident point\n    const points = [];\n    let e = e0;\n    do {\n      const t = Math.floor(e / 3);\n      points.push(circumcenters[t * 2], circumcenters[t * 2 + 1]);\n      e = e % 3 === 2 ? e - 2 : e + 1;\n      if (triangles[e] !== i) break; // bad triangulation\n      e = halfedges[e];\n    } while (e !== e0 && e !== -1);\n    return points;\n  }\n  _clip(i) {\n    // degenerate case (1 valid point: return the box)\n    if (i === 0 && this.delaunay.hull.length === 1) {\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\n    }\n    const points = this._cell(i);\n    if (points === null) return null;\n    const {vectors: V} = this;\n    const v = i * 4;\n    return this._simplify(V[v] || V[v + 1]\n        ? this._clipInfinite(i, points, V[v], V[v + 1], V[v + 2], V[v + 3])\n        : this._clipFinite(i, points));\n  }\n  _clipFinite(i, points) {\n    const n = points.length;\n    let P = null;\n    let x0, y0, x1 = points[n - 2], y1 = points[n - 1];\n    let c0, c1 = this._regioncode(x1, y1);\n    let e0, e1 = 0;\n    for (let j = 0; j < n; j += 2) {\n      x0 = x1, y0 = y1, x1 = points[j], y1 = points[j + 1];\n      c0 = c1, c1 = this._regioncode(x1, y1);\n      if (c0 === 0 && c1 === 0) {\n        e0 = e1, e1 = 0;\n        if (P) P.push(x1, y1);\n        else P = [x1, y1];\n      } else {\n        let S, sx0, sy0, sx1, sy1;\n        if (c0 === 0) {\n          if ((S = this._clipSegment(x0, y0, x1, y1, c0, c1)) === null) continue;\n          [sx0, sy0, sx1, sy1] = S;\n        } else {\n          if ((S = this._clipSegment(x1, y1, x0, y0, c1, c0)) === null) continue;\n          [sx1, sy1, sx0, sy0] = S;\n          e0 = e1, e1 = this._edgecode(sx0, sy0);\n          if (e0 && e1) this._edge(i, e0, e1, P, P.length);\n          if (P) P.push(sx0, sy0);\n          else P = [sx0, sy0];\n        }\n        e0 = e1, e1 = this._edgecode(sx1, sy1);\n        if (e0 && e1) this._edge(i, e0, e1, P, P.length);\n        if (P) P.push(sx1, sy1);\n        else P = [sx1, sy1];\n      }\n    }\n    if (P) {\n      e0 = e1, e1 = this._edgecode(P[0], P[1]);\n      if (e0 && e1) this._edge(i, e0, e1, P, P.length);\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\n      return [this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax, this.xmin, this.ymin];\n    }\n    return P;\n  }\n  _clipSegment(x0, y0, x1, y1, c0, c1) {\n    // for more robustness, always consider the segment in the same order\n    const flip = c0 < c1;\n    if (flip) [x0, y0, x1, y1, c0, c1] = [x1, y1, x0, y0, c1, c0];\n    while (true) {\n      if (c0 === 0 && c1 === 0) return flip ? [x1, y1, x0, y0] : [x0, y0, x1, y1];\n      if (c0 & c1) return null;\n      let x, y, c = c0 || c1;\n      if (c & 0b1000) x = x0 + (x1 - x0) * (this.ymax - y0) / (y1 - y0), y = this.ymax;\n      else if (c & 0b0100) x = x0 + (x1 - x0) * (this.ymin - y0) / (y1 - y0), y = this.ymin;\n      else if (c & 0b0010) y = y0 + (y1 - y0) * (this.xmax - x0) / (x1 - x0), x = this.xmax;\n      else y = y0 + (y1 - y0) * (this.xmin - x0) / (x1 - x0), x = this.xmin;\n      if (c0) x0 = x, y0 = y, c0 = this._regioncode(x0, y0);\n      else x1 = x, y1 = y, c1 = this._regioncode(x1, y1);\n    }\n  }\n  _clipInfinite(i, points, vx0, vy0, vxn, vyn) {\n    let P = Array.from(points), p;\n    if (p = this._project(P[0], P[1], vx0, vy0)) P.unshift(p[0], p[1]);\n    if (p = this._project(P[P.length - 2], P[P.length - 1], vxn, vyn)) P.push(p[0], p[1]);\n    if (P = this._clipFinite(i, P)) {\n      for (let j = 0, n = P.length, c0, c1 = this._edgecode(P[n - 2], P[n - 1]); j < n; j += 2) {\n        c0 = c1, c1 = this._edgecode(P[j], P[j + 1]);\n        if (c0 && c1) j = this._edge(i, c0, c1, P, j), n = P.length;\n      }\n    } else if (this.contains(i, (this.xmin + this.xmax) / 2, (this.ymin + this.ymax) / 2)) {\n      P = [this.xmin, this.ymin, this.xmax, this.ymin, this.xmax, this.ymax, this.xmin, this.ymax];\n    }\n    return P;\n  }\n  _edge(i, e0, e1, P, j) {\n    while (e0 !== e1) {\n      let x, y;\n      switch (e0) {\n        case 0b0101: e0 = 0b0100; continue; // top-left\n        case 0b0100: e0 = 0b0110, x = this.xmax, y = this.ymin; break; // top\n        case 0b0110: e0 = 0b0010; continue; // top-right\n        case 0b0010: e0 = 0b1010, x = this.xmax, y = this.ymax; break; // right\n        case 0b1010: e0 = 0b1000; continue; // bottom-right\n        case 0b1000: e0 = 0b1001, x = this.xmin, y = this.ymax; break; // bottom\n        case 0b1001: e0 = 0b0001; continue; // bottom-left\n        case 0b0001: e0 = 0b0101, x = this.xmin, y = this.ymin; break; // left\n      }\n      // Note: this implicitly checks for out of bounds: if P[j] or P[j+1] are\n      // undefined, the conditional statement will be executed.\n      if ((P[j] !== x || P[j + 1] !== y) && this.contains(i, x, y)) {\n        P.splice(j, 0, x, y), j += 2;\n      }\n    }\n    return j;\n  }\n  _project(x0, y0, vx, vy) {\n    let t = Infinity, c, x, y;\n    if (vy < 0) { // top\n      if (y0 <= this.ymin) return null;\n      if ((c = (this.ymin - y0) / vy) < t) y = this.ymin, x = x0 + (t = c) * vx;\n    } else if (vy > 0) { // bottom\n      if (y0 >= this.ymax) return null;\n      if ((c = (this.ymax - y0) / vy) < t) y = this.ymax, x = x0 + (t = c) * vx;\n    }\n    if (vx > 0) { // right\n      if (x0 >= this.xmax) return null;\n      if ((c = (this.xmax - x0) / vx) < t) x = this.xmax, y = y0 + (t = c) * vy;\n    } else if (vx < 0) { // left\n      if (x0 <= this.xmin) return null;\n      if ((c = (this.xmin - x0) / vx) < t) x = this.xmin, y = y0 + (t = c) * vy;\n    }\n    return [x, y];\n  }\n  _edgecode(x, y) {\n    return (x === this.xmin ? 0b0001\n        : x === this.xmax ? 0b0010 : 0b0000)\n        | (y === this.ymin ? 0b0100\n        : y === this.ymax ? 0b1000 : 0b0000);\n  }\n  _regioncode(x, y) {\n    return (x < this.xmin ? 0b0001\n        : x > this.xmax ? 0b0010 : 0b0000)\n        | (y < this.ymin ? 0b0100\n        : y > this.ymax ? 0b1000 : 0b0000);\n  }\n  _simplify(P) {\n    if (P && P.length > 4) {\n      for (let i = 0; i < P.length; i+= 2) {\n        const j = (i + 2) % P.length, k = (i + 4) % P.length;\n        if (P[i] === P[j] && P[j] === P[k] || P[i + 1] === P[j + 1] && P[j + 1] === P[k + 1]) {\n          P.splice(j, 2), i -= 2;\n        }\n      }\n      if (!P.length) P = null;\n    }\n    return P;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}