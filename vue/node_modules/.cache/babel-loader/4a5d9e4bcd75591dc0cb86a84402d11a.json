{"ast":null,"code":"import { o as onDispose, l as listenEvent, D as DOMEvent, s as scoped } from '../chunks/vidstack-b8ba7e3c.js';\nimport { d as canUsePictureInPicture, e as canUseVideoPresentation, b as canPlayHLSNatively } from '../chunks/vidstack-e4c46e48.js';\nimport { H as HTMLMediaProvider } from '../chunks/vidstack-644e676d.js';\nimport { a as TextTrack, T as TextTrackSymbol } from '../chunks/vidstack-dd29a7a5.js';\nimport 'media-captions';\n\nclass NativeHLSTextTracks {\n  constructor(_video, _context) {\n    this._video = _video;\n    this._context = _context;\n    _video.textTracks.onaddtrack = this._onAddTrack.bind(this);\n    onDispose(this._onDispose.bind(this));\n  }\n\n  _onAddTrack(event) {\n    const nativeTrack = event.track;\n    if (!nativeTrack || findTextTrackElement(this._video, nativeTrack)) return;\n    const track = new TextTrack({\n      id: nativeTrack.id,\n      kind: nativeTrack.kind,\n      label: nativeTrack.label,\n      language: nativeTrack.language,\n      type: \"vtt\"\n    });\n    track[TextTrackSymbol._native] = {\n      track: nativeTrack\n    };\n    track[TextTrackSymbol._readyState] = 2;\n    track[TextTrackSymbol._nativeHLS] = true;\n    let lastIndex = 0;\n\n    const onCueChange = event2 => {\n      if (!nativeTrack.cues) return;\n\n      for (let i = lastIndex; i < nativeTrack.cues.length; i++) {\n        track.addCue(nativeTrack.cues[i], event2);\n        lastIndex++;\n      }\n    };\n\n    onCueChange(event);\n    nativeTrack.oncuechange = onCueChange;\n\n    this._context.textTracks.add(track, event);\n\n    track.setMode(nativeTrack.mode, event);\n  }\n\n  _onDispose() {\n    this._video.textTracks.onaddtrack = null;\n\n    for (const track of this._context.textTracks) {\n      const nativeTrack = track[TextTrackSymbol._native]?.track;\n      if (nativeTrack?.oncuechange) nativeTrack.oncuechange = null;\n    }\n  }\n\n}\n\nfunction findTextTrackElement(video, track) {\n  return Array.from(video.children).find(el => el.track === track);\n}\n\nclass VideoPictureInPicture {\n  constructor(_video, _media) {\n    this._video = _video;\n    this._media = _media;\n\n    this._onChange = (active, event) => {\n      this._media.delegate._dispatch(\"picture-in-picture-change\", {\n        detail: active,\n        trigger: event\n      });\n    };\n\n    listenEvent(this._video, \"enterpictureinpicture\", this._onEnter.bind(this));\n    listenEvent(this._video, \"leavepictureinpicture\", this._onExit.bind(this));\n  }\n\n  get active() {\n    return document.pictureInPictureElement === this._video;\n  }\n\n  get supported() {\n    return canUsePictureInPicture(this._video);\n  }\n\n  async enter() {\n    return this._video.requestPictureInPicture();\n  }\n\n  exit() {\n    return document.exitPictureInPicture();\n  }\n\n  _onEnter(event) {\n    this._onChange(true, event);\n  }\n\n  _onExit(event) {\n    this._onChange(false, event);\n  }\n\n}\n\nclass VideoPresentation {\n  constructor(_video, _media) {\n    this._video = _video;\n    this._media = _media;\n    this._mode = \"inline\";\n    listenEvent(this._video, \"webkitpresentationmodechanged\", this._onModeChange.bind(this));\n  }\n\n  get _supported() {\n    return canUseVideoPresentation(this._video);\n  }\n\n  async _setPresentationMode(mode) {\n    if (this._mode === mode) return;\n\n    this._video.webkitSetPresentationMode(mode);\n  }\n\n  _onModeChange() {\n    const prevMode = this._mode;\n    this._mode = this._video.webkitPresentationMode;\n    {\n      this._media.logger?.infoGroup(\"presentation mode change\").labelledLog(\"Mode\", this._mode).labelledLog(\"Event\", event).dispatch();\n    }\n    this._media.player?.dispatch(new DOMEvent(\"video-presentation-change\", {\n      detail: this._mode,\n      trigger: event\n    }));\n    [\"fullscreen\", \"picture-in-picture\"].forEach(type => {\n      if (this._mode === type || prevMode === type) {\n        this._media.delegate._dispatch(`${type}-change`, {\n          detail: this._mode === type,\n          trigger: event\n        });\n      }\n    });\n  }\n\n}\n\nclass FullscreenPresentationAdapter {\n  constructor(_presentation) {\n    this._presentation = _presentation;\n  }\n\n  get active() {\n    return this._presentation._mode === \"fullscreen\";\n  }\n\n  get supported() {\n    return this._presentation._supported;\n  }\n\n  async enter() {\n    this._presentation._setPresentationMode(\"fullscreen\");\n  }\n\n  async exit() {\n    this._presentation._setPresentationMode(\"inline\");\n  }\n\n}\n\nclass PIPPresentationAdapter {\n  constructor(_presentation) {\n    this._presentation = _presentation;\n  }\n\n  get active() {\n    return this._presentation._mode === \"picture-in-picture\";\n  }\n\n  get supported() {\n    return this._presentation._supported;\n  }\n\n  async enter() {\n    this._presentation._setPresentationMode(\"picture-in-picture\");\n  }\n\n  async exit() {\n    this._presentation._setPresentationMode(\"inline\");\n  }\n\n}\n\nclass VideoProvider extends HTMLMediaProvider {\n  constructor(video, context) {\n    super(video);\n    this.$$PROVIDER_TYPE = \"VIDEO\";\n    scoped(() => {\n      if (canUseVideoPresentation(video)) {\n        const presentation = new VideoPresentation(video, context);\n        this.fullscreen = new FullscreenPresentationAdapter(presentation);\n        this.pictureInPicture = new PIPPresentationAdapter(presentation);\n      } else if (canUsePictureInPicture(video)) {\n        this.pictureInPicture = new VideoPictureInPicture(video, context);\n      }\n    }, this.scope);\n  }\n\n  get type() {\n    return \"video\";\n  }\n\n  setup(context) {\n    super.setup(context);\n\n    if (canPlayHLSNatively(this.video)) {\n      new NativeHLSTextTracks(this.video, context);\n    }\n\n    context.textRenderers._attachVideo(this.video);\n\n    onDispose(() => {\n      context.textRenderers._attachVideo(null);\n    });\n    if (this.type === \"video\") context.delegate._dispatch(\"provider-setup\", {\n      detail: this\n    });\n  }\n  /**\n   * The native HTML `<video>` element.\n   *\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement}\n   */\n\n\n  get video() {\n    return this._media;\n  }\n\n}\n\nexport { VideoProvider };","map":{"version":3,"sources":["/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/vue/node_modules/vidstack/dist/dev/providers/vidstack-video.js"],"names":["o","onDispose","l","listenEvent","D","DOMEvent","s","scoped","d","canUsePictureInPicture","e","canUseVideoPresentation","b","canPlayHLSNatively","H","HTMLMediaProvider","a","TextTrack","T","TextTrackSymbol","NativeHLSTextTracks","constructor","_video","_context","textTracks","onaddtrack","_onAddTrack","bind","_onDispose","event","nativeTrack","track","findTextTrackElement","id","kind","label","language","type","_native","_readyState","_nativeHLS","lastIndex","onCueChange","event2","cues","i","length","addCue","oncuechange","add","setMode","mode","video","Array","from","children","find","el","VideoPictureInPicture","_media","_onChange","active","delegate","_dispatch","detail","trigger","_onEnter","_onExit","document","pictureInPictureElement","supported","enter","requestPictureInPicture","exit","exitPictureInPicture","VideoPresentation","_mode","_onModeChange","_supported","_setPresentationMode","webkitSetPresentationMode","prevMode","webkitPresentationMode","logger","infoGroup","labelledLog","dispatch","player","forEach","FullscreenPresentationAdapter","_presentation","PIPPresentationAdapter","VideoProvider","context","$$PROVIDER_TYPE","presentation","fullscreen","pictureInPicture","scope","setup","textRenderers","_attachVideo"],"mappings":"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","sourcesContent":["import { o as onDispose, l as listenEvent, D as DOMEvent, s as scoped } from '../chunks/vidstack-b8ba7e3c.js';\nimport { d as canUsePictureInPicture, e as canUseVideoPresentation, b as canPlayHLSNatively } from '../chunks/vidstack-e4c46e48.js';\nimport { H as HTMLMediaProvider } from '../chunks/vidstack-644e676d.js';\nimport { a as TextTrack, T as TextTrackSymbol } from '../chunks/vidstack-dd29a7a5.js';\nimport 'media-captions';\n\nclass NativeHLSTextTracks {\n  constructor(_video, _context) {\n    this._video = _video;\n    this._context = _context;\n    _video.textTracks.onaddtrack = this._onAddTrack.bind(this);\n    onDispose(this._onDispose.bind(this));\n  }\n  _onAddTrack(event) {\n    const nativeTrack = event.track;\n    if (!nativeTrack || findTextTrackElement(this._video, nativeTrack))\n      return;\n    const track = new TextTrack({\n      id: nativeTrack.id,\n      kind: nativeTrack.kind,\n      label: nativeTrack.label,\n      language: nativeTrack.language,\n      type: \"vtt\"\n    });\n    track[TextTrackSymbol._native] = { track: nativeTrack };\n    track[TextTrackSymbol._readyState] = 2;\n    track[TextTrackSymbol._nativeHLS] = true;\n    let lastIndex = 0;\n    const onCueChange = (event2) => {\n      if (!nativeTrack.cues)\n        return;\n      for (let i = lastIndex; i < nativeTrack.cues.length; i++) {\n        track.addCue(nativeTrack.cues[i], event2);\n        lastIndex++;\n      }\n    };\n    onCueChange(event);\n    nativeTrack.oncuechange = onCueChange;\n    this._context.textTracks.add(track, event);\n    track.setMode(nativeTrack.mode, event);\n  }\n  _onDispose() {\n    this._video.textTracks.onaddtrack = null;\n    for (const track of this._context.textTracks) {\n      const nativeTrack = track[TextTrackSymbol._native]?.track;\n      if (nativeTrack?.oncuechange)\n        nativeTrack.oncuechange = null;\n    }\n  }\n}\nfunction findTextTrackElement(video, track) {\n  return Array.from(video.children).find((el) => el.track === track);\n}\n\nclass VideoPictureInPicture {\n  constructor(_video, _media) {\n    this._video = _video;\n    this._media = _media;\n    this._onChange = (active, event) => {\n      this._media.delegate._dispatch(\"picture-in-picture-change\", {\n        detail: active,\n        trigger: event\n      });\n    };\n    listenEvent(this._video, \"enterpictureinpicture\", this._onEnter.bind(this));\n    listenEvent(this._video, \"leavepictureinpicture\", this._onExit.bind(this));\n  }\n  get active() {\n    return document.pictureInPictureElement === this._video;\n  }\n  get supported() {\n    return canUsePictureInPicture(this._video);\n  }\n  async enter() {\n    return this._video.requestPictureInPicture();\n  }\n  exit() {\n    return document.exitPictureInPicture();\n  }\n  _onEnter(event) {\n    this._onChange(true, event);\n  }\n  _onExit(event) {\n    this._onChange(false, event);\n  }\n}\n\nclass VideoPresentation {\n  constructor(_video, _media) {\n    this._video = _video;\n    this._media = _media;\n    this._mode = \"inline\";\n    listenEvent(this._video, \"webkitpresentationmodechanged\", this._onModeChange.bind(this));\n  }\n  get _supported() {\n    return canUseVideoPresentation(this._video);\n  }\n  async _setPresentationMode(mode) {\n    if (this._mode === mode)\n      return;\n    this._video.webkitSetPresentationMode(mode);\n  }\n  _onModeChange() {\n    const prevMode = this._mode;\n    this._mode = this._video.webkitPresentationMode;\n    {\n      this._media.logger?.infoGroup(\"presentation mode change\").labelledLog(\"Mode\", this._mode).labelledLog(\"Event\", event).dispatch();\n    }\n    this._media.player?.dispatch(\n      new DOMEvent(\"video-presentation-change\", {\n        detail: this._mode,\n        trigger: event\n      })\n    );\n    [\"fullscreen\", \"picture-in-picture\"].forEach((type) => {\n      if (this._mode === type || prevMode === type) {\n        this._media.delegate._dispatch(`${type}-change`, {\n          detail: this._mode === type,\n          trigger: event\n        });\n      }\n    });\n  }\n}\nclass FullscreenPresentationAdapter {\n  constructor(_presentation) {\n    this._presentation = _presentation;\n  }\n  get active() {\n    return this._presentation._mode === \"fullscreen\";\n  }\n  get supported() {\n    return this._presentation._supported;\n  }\n  async enter() {\n    this._presentation._setPresentationMode(\"fullscreen\");\n  }\n  async exit() {\n    this._presentation._setPresentationMode(\"inline\");\n  }\n}\nclass PIPPresentationAdapter {\n  constructor(_presentation) {\n    this._presentation = _presentation;\n  }\n  get active() {\n    return this._presentation._mode === \"picture-in-picture\";\n  }\n  get supported() {\n    return this._presentation._supported;\n  }\n  async enter() {\n    this._presentation._setPresentationMode(\"picture-in-picture\");\n  }\n  async exit() {\n    this._presentation._setPresentationMode(\"inline\");\n  }\n}\n\nclass VideoProvider extends HTMLMediaProvider {\n  constructor(video, context) {\n    super(video);\n    this.$$PROVIDER_TYPE = \"VIDEO\";\n    scoped(() => {\n      if (canUseVideoPresentation(video)) {\n        const presentation = new VideoPresentation(video, context);\n        this.fullscreen = new FullscreenPresentationAdapter(presentation);\n        this.pictureInPicture = new PIPPresentationAdapter(presentation);\n      } else if (canUsePictureInPicture(video)) {\n        this.pictureInPicture = new VideoPictureInPicture(video, context);\n      }\n    }, this.scope);\n  }\n  get type() {\n    return \"video\";\n  }\n  setup(context) {\n    super.setup(context);\n    if (canPlayHLSNatively(this.video)) {\n      new NativeHLSTextTracks(this.video, context);\n    }\n    context.textRenderers._attachVideo(this.video);\n    onDispose(() => {\n      context.textRenderers._attachVideo(null);\n    });\n    if (this.type === \"video\")\n      context.delegate._dispatch(\"provider-setup\", { detail: this });\n  }\n  /**\n   * The native HTML `<video>` element.\n   *\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement}\n   */\n  get video() {\n    return this._media;\n  }\n}\n\nexport { VideoProvider };\n"]},"metadata":{},"sourceType":"module"}