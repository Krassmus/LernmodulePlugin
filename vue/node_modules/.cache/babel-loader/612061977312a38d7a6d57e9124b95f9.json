{"ast":null,"code":"import { g as IS_SAFARI, h as isHLSSrc, j as getNumberOfDecimalPlaces, L as ListSymbol, k as isMediaStream } from './vidstack-e4c46e48.js';\nimport { y as isUndefined, A as isNumber, B as useDisposalBin, e as effect, o as onDispose, l as listenEvent, D as DOMEvent, E as isNil, F as createScope, f as setAttribute, k as isString } from './vidstack-b8ba7e3c.js';\n\nclass RAFLoop {\n  constructor(_callback) {\n    this._callback = _callback;\n  }\n\n  _start() {\n    if (!isUndefined(this._id)) return;\n\n    this._loop();\n  }\n\n  _stop() {\n    if (isNumber(this._id)) window.cancelAnimationFrame(this._id);\n    this._id = void 0;\n  }\n\n  _loop() {\n    this._id = window.requestAnimationFrame(() => {\n      if (isUndefined(this._id)) return;\n\n      this._callback();\n\n      this._loop();\n    });\n  }\n\n}\n\nclass HTMLMediaEvents {\n  constructor(_provider, _ctx) {\n    this._provider = _provider;\n    this._ctx = _ctx;\n    this._disposal = useDisposalBin();\n    this._waiting = false;\n    this._attachedLoadStart = false;\n    this._attachedCanPlay = false;\n    this._timeRAF = new RAFLoop(this._onRAF.bind(this));\n    this._handlers = /* @__PURE__ */new Map();\n    this._handleDevEvent = this._onDevEvent.bind(this);\n\n    this._attachInitialListeners();\n\n    effect(this._attachTimeUpdate.bind(this));\n    onDispose(this._onDispose.bind(this));\n  }\n\n  get _media() {\n    return this._provider.media;\n  }\n\n  get _delegate() {\n    return this._ctx.delegate;\n  }\n\n  _onDispose() {\n    this._attachedLoadStart = false;\n    this._attachedCanPlay = false;\n\n    this._timeRAF._stop();\n\n    this._disposal.empty();\n  }\n  /**\n   * The `timeupdate` event fires surprisingly infrequently during playback, meaning your progress\n   * bar (or whatever else is synced to the currentTime) moves in a choppy fashion. This helps\n   * resolve that by retrieving time updates in a request animation frame loop.\n   */\n\n\n  _onRAF() {\n    const newTime = this._provider.currentTime;\n    if (this._ctx.$state.currentTime() !== newTime) this._updateCurrentTime(newTime);\n  }\n\n  _attachInitialListeners() {\n    {\n      this._ctx.logger?.info(\"attaching initial listeners\");\n    }\n\n    this._attachEventListener(\"loadstart\", this._onLoadStart);\n\n    this._attachEventListener(\"abort\", this._onAbort);\n\n    this._attachEventListener(\"emptied\", this._onEmptied);\n\n    this._attachEventListener(\"error\", this._onError);\n\n    this._ctx.logger?.debug(\"attached initial media event listeners\");\n  }\n\n  _attachLoadStartListeners() {\n    if (this._attachedLoadStart) return;\n    {\n      this._ctx.logger?.info(\"attaching load start listeners\");\n    }\n\n    this._disposal.add(this._attachEventListener(\"loadeddata\", this._onLoadedData), this._attachEventListener(\"loadedmetadata\", this._onLoadedMetadata), this._attachEventListener(\"canplay\", this._onCanPlay), this._attachEventListener(\"canplaythrough\", this._onCanPlayThrough), this._attachEventListener(\"durationchange\", this._onDurationChange), this._attachEventListener(\"play\", this._onPlay), this._attachEventListener(\"progress\", this._onProgress), this._attachEventListener(\"stalled\", this._onStalled), this._attachEventListener(\"suspend\", this._onSuspend));\n\n    this._attachedLoadStart = true;\n  }\n\n  _attachCanPlayListeners() {\n    if (this._attachedCanPlay) return;\n    {\n      this._ctx.logger?.info(\"attaching can play listeners\");\n    }\n\n    this._disposal.add(this._attachEventListener(\"pause\", this._onPause), this._attachEventListener(\"playing\", this._onPlaying), this._attachEventListener(\"ratechange\", this._onRateChange), this._attachEventListener(\"seeked\", this._onSeeked), this._attachEventListener(\"seeking\", this._onSeeking), this._attachEventListener(\"ended\", this._onEnded), this._attachEventListener(\"volumechange\", this._onVolumeChange), this._attachEventListener(\"waiting\", this._onWaiting));\n\n    this._attachedCanPlay = true;\n  }\n\n  _attachEventListener(eventType, handler) {\n    this._handlers.set(eventType, handler);\n\n    return listenEvent(this._media, eventType, this._handleDevEvent);\n  }\n\n  _onDevEvent(event2) {\n    this._ctx.logger?.debugGroup(`\\u{1F4FA} provider fired \\`${event2.type}\\``).labelledLog(\"Provider\", this._provider).labelledLog(\"Event\", event2).labelledLog(\"Media Store\", { ...this._ctx.$state\n    }).dispatch();\n    this._handlers.get(event2.type)?.call(this, event2);\n  }\n\n  _updateCurrentTime(time, trigger) {\n    this._delegate._dispatch(\"time-update\", {\n      // Avoid errors where `currentTime` can have higher precision.\n      detail: {\n        currentTime: Math.min(time, this._ctx.$state.seekableEnd()),\n        played: this._media.played\n      },\n      trigger\n    });\n  }\n\n  _onLoadStart(event2) {\n    if (this._media.networkState === 3) {\n      this._onAbort(event2);\n\n      return;\n    }\n\n    this._attachLoadStartListeners();\n\n    this._delegate._dispatch(\"load-start\", {\n      trigger: event2\n    });\n  }\n\n  _onAbort(event2) {\n    this._delegate._dispatch(\"abort\", {\n      trigger: event2\n    });\n  }\n\n  _onEmptied() {\n    this._delegate._dispatch(\"emptied\", {\n      trigger: event\n    });\n  }\n\n  _onLoadedData(event2) {\n    this._delegate._dispatch(\"loaded-data\", {\n      trigger: event2\n    });\n  }\n\n  _onLoadedMetadata(event2) {\n    this._attachCanPlayListeners();\n\n    this._delegate._dispatch(\"volume-change\", {\n      detail: {\n        volume: this._media.volume,\n        muted: this._media.muted\n      }\n    });\n\n    this._delegate._dispatch(\"loaded-metadata\", {\n      trigger: event2\n    });\n\n    if (IS_SAFARI && isHLSSrc(this._ctx.$state.source())) {\n      this._delegate._ready(this._getCanPlayDetail(), event2);\n    }\n  }\n\n  _getCanPlayDetail() {\n    return {\n      duration: this._media.duration,\n      buffered: this._media.buffered,\n      seekable: this._media.seekable\n    };\n  }\n\n  _onPlay(event2) {\n    if (!this._ctx.$state.canPlay) return;\n\n    this._delegate._dispatch(\"play\", {\n      trigger: event2\n    });\n  }\n\n  _onPause(event2) {\n    if (this._media.readyState === 1 && !this._waiting) return;\n    this._waiting = false;\n\n    this._timeRAF._stop();\n\n    this._delegate._dispatch(\"pause\", {\n      trigger: event2\n    });\n  }\n\n  _onCanPlay(event2) {\n    this._delegate._ready(this._getCanPlayDetail(), event2);\n  }\n\n  _onCanPlayThrough(event2) {\n    if (this._ctx.$state.started()) return;\n\n    this._delegate._dispatch(\"can-play-through\", {\n      trigger: event2,\n      detail: this._getCanPlayDetail()\n    });\n  }\n\n  _onPlaying(event2) {\n    this._waiting = false;\n\n    this._delegate._dispatch(\"playing\", {\n      trigger: event2\n    });\n\n    this._timeRAF._start();\n  }\n\n  _onStalled(event2) {\n    this._delegate._dispatch(\"stalled\", {\n      trigger: event2\n    });\n\n    if (this._media.readyState < 3) {\n      this._waiting = true;\n\n      this._delegate._dispatch(\"waiting\", {\n        trigger: event2\n      });\n    }\n  }\n\n  _onWaiting(event2) {\n    if (this._media.readyState < 3) {\n      this._waiting = true;\n\n      this._delegate._dispatch(\"waiting\", {\n        trigger: event2\n      });\n    }\n  }\n\n  _onEnded(event2) {\n    this._timeRAF._stop();\n\n    this._updateCurrentTime(this._media.duration, event2);\n\n    this._delegate._dispatch(\"end\", {\n      trigger: event2\n    });\n\n    if (this._ctx.$state.loop()) {\n      this._onLoop();\n    } else {\n      this._delegate._dispatch(\"ended\", {\n        trigger: event2\n      });\n    }\n  }\n\n  _attachTimeUpdate() {\n    if (this._ctx.$state.paused()) {\n      listenEvent(this._media, \"timeupdate\", this._onTimeUpdate.bind(this));\n    }\n  }\n\n  _onTimeUpdate(event2) {\n    this._updateCurrentTime(this._media.currentTime, event2);\n  }\n\n  _onDurationChange(event2) {\n    if (this._ctx.$state.ended()) {\n      this._updateCurrentTime(this._media.duration, event2);\n    }\n\n    this._delegate._dispatch(\"duration-change\", {\n      detail: this._media.duration,\n      trigger: event2\n    });\n  }\n\n  _onVolumeChange(event2) {\n    this._delegate._dispatch(\"volume-change\", {\n      detail: {\n        volume: this._media.volume,\n        muted: this._media.muted\n      },\n      trigger: event2\n    });\n  }\n\n  _onSeeked(event2) {\n    this._updateCurrentTime(this._media.currentTime, event2);\n\n    this._delegate._dispatch(\"seeked\", {\n      detail: this._media.currentTime,\n      trigger: event2\n    });\n\n    if (Math.trunc(this._media.currentTime) === Math.trunc(this._media.duration) && getNumberOfDecimalPlaces(this._media.duration) > getNumberOfDecimalPlaces(this._media.currentTime)) {\n      this._updateCurrentTime(this._media.duration, event2);\n\n      if (!this._media.ended) {\n        this._ctx.player.dispatch(new DOMEvent(\"media-play-request\", {\n          trigger: event2\n        }));\n      }\n    }\n  }\n\n  _onSeeking(event2) {\n    this._delegate._dispatch(\"seeking\", {\n      detail: this._media.currentTime,\n      trigger: event2\n    });\n  }\n\n  _onProgress(event2) {\n    this._delegate._dispatch(\"progress\", {\n      detail: {\n        buffered: this._media.buffered,\n        seekable: this._media.seekable\n      },\n      trigger: event2\n    });\n  }\n\n  _onLoop() {\n    const hasCustomControls = isNil(this._media.controls);\n    if (hasCustomControls) this._media.controls = false;\n\n    this._ctx.player.dispatch(new DOMEvent(\"media-loop-request\"));\n  }\n\n  _onSuspend(event2) {\n    this._delegate._dispatch(\"suspend\", {\n      trigger: event2\n    });\n  }\n\n  _onRateChange(event2) {\n    this._delegate._dispatch(\"rate-change\", {\n      detail: this._media.playbackRate,\n      trigger: event2\n    });\n  }\n\n  _onError(event2) {\n    const error = this._media.error;\n    if (!error) return;\n\n    this._delegate._dispatch(\"error\", {\n      detail: {\n        message: error.message,\n        code: error.code,\n        mediaError: error\n      },\n      trigger: event2\n    });\n  }\n\n}\n\nclass NativeAudioTracks {\n  constructor(_provider, _context) {\n    this._provider = _provider;\n    this._context = _context;\n    this._nativeTracks.onaddtrack = this._onAddNativeTrack.bind(this);\n    this._nativeTracks.onremovetrack = this._onRemoveNativeTrack.bind(this);\n    this._nativeTracks.onchange = this._onChangeNativeTrack.bind(this);\n    listenEvent(this._context.audioTracks, \"change\", this._onChangeTrack.bind(this));\n  }\n\n  get _nativeTracks() {\n    return this._provider.media.audioTracks;\n  }\n\n  _onAddNativeTrack(event) {\n    const _track = event.track;\n    if (_track.label === \"\") return;\n    const audioTrack = {\n      id: _track.id + \"\",\n      label: _track.label,\n      language: _track.language,\n      kind: _track.kind,\n      selected: false\n    };\n\n    this._context.audioTracks[ListSymbol._add](audioTrack, event);\n\n    if (_track.enabled) audioTrack.selected = true;\n  }\n\n  _onRemoveNativeTrack(event) {\n    const track = this._context.audioTracks.getById(event.track.id);\n\n    if (track) this._context.audioTracks[ListSymbol._remove](track, event);\n  }\n\n  _onChangeNativeTrack(event) {\n    let enabledTrack = this._getEnabledNativeTrack();\n\n    if (!enabledTrack) return;\n\n    const track = this._context.audioTracks.getById(enabledTrack.id);\n\n    if (track) this._context.audioTracks[ListSymbol._select](track, true, event);\n  }\n\n  _getEnabledNativeTrack() {\n    return Array.from(this._nativeTracks).find(track => track.enabled);\n  }\n\n  _onChangeTrack(event) {\n    const {\n      current\n    } = event.detail;\n    if (!current) return;\n\n    const track = this._nativeTracks.getTrackById(current.id);\n\n    if (track) {\n      const prev = this._getEnabledNativeTrack();\n\n      if (prev) prev.enabled = false;\n      track.enabled = true;\n    }\n  }\n\n}\n\nclass HTMLMediaProvider {\n  constructor(_media) {\n    this._media = _media;\n    this.scope = createScope();\n    this._currentSrc = null;\n  }\n\n  setup(context) {\n    new HTMLMediaEvents(this, context);\n    if (\"audioTracks\" in this.media) new NativeAudioTracks(this, context);\n    this.playsinline = context.$state.playsinline();\n    onDispose(() => {\n      this._media.setAttribute(\"src\", \"\");\n\n      this._media.load();\n    });\n  }\n\n  get type() {\n    return \"\";\n  }\n\n  get media() {\n    return this._media;\n  }\n\n  get currentSrc() {\n    return this._currentSrc;\n  }\n\n  get paused() {\n    return this._media.paused;\n  }\n\n  get muted() {\n    return this._media.muted;\n  }\n\n  set muted(muted) {\n    this._media.muted = muted;\n  }\n\n  get volume() {\n    return this._media.volume;\n  }\n\n  set volume(volume) {\n    this._media.volume = volume;\n  }\n\n  get currentTime() {\n    return this._media.currentTime;\n  }\n\n  set currentTime(time) {\n    this._media.currentTime = time;\n  }\n\n  get playsinline() {\n    return this._media.hasAttribute(\"playsinline\");\n  }\n\n  set playsinline(playsinline) {\n    setAttribute(this._media, \"playsinline\", playsinline);\n  }\n\n  get playbackRate() {\n    return this._media.playbackRate;\n  }\n\n  set playbackRate(rate) {\n    this._media.playbackRate = rate;\n  }\n\n  async play() {\n    return this._media.play();\n  }\n\n  async pause() {\n    return this._media.pause();\n  }\n\n  async loadSource({\n    src,\n    type\n  }, preload) {\n    this._media.preload = preload || \"\";\n\n    if (isMediaStream(src)) {\n      this._media.srcObject = src;\n    } else {\n      this._media.srcObject = null;\n      this._media.src = isString(src) ? src : window.URL.createObjectURL(src);\n    }\n\n    this._media.load();\n\n    this._currentSrc = {\n      src,\n      type\n    };\n  }\n\n}\n\nexport { HTMLMediaProvider as H, RAFLoop as R };","map":{"version":3,"sources":["/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/vue/node_modules/vidstack/dist/dev/chunks/vidstack-644e676d.js"],"names":["g","IS_SAFARI","h","isHLSSrc","j","getNumberOfDecimalPlaces","L","ListSymbol","k","isMediaStream","y","isUndefined","A","isNumber","B","useDisposalBin","e","effect","o","onDispose","l","listenEvent","D","DOMEvent","E","isNil","F","createScope","f","setAttribute","isString","RAFLoop","constructor","_callback","_start","_id","_loop","_stop","window","cancelAnimationFrame","requestAnimationFrame","HTMLMediaEvents","_provider","_ctx","_disposal","_waiting","_attachedLoadStart","_attachedCanPlay","_timeRAF","_onRAF","bind","_handlers","Map","_handleDevEvent","_onDevEvent","_attachInitialListeners","_attachTimeUpdate","_onDispose","_media","media","_delegate","delegate","empty","newTime","currentTime","$state","_updateCurrentTime","logger","info","_attachEventListener","_onLoadStart","_onAbort","_onEmptied","_onError","debug","_attachLoadStartListeners","add","_onLoadedData","_onLoadedMetadata","_onCanPlay","_onCanPlayThrough","_onDurationChange","_onPlay","_onProgress","_onStalled","_onSuspend","_attachCanPlayListeners","_onPause","_onPlaying","_onRateChange","_onSeeked","_onSeeking","_onEnded","_onVolumeChange","_onWaiting","eventType","handler","set","event2","debugGroup","type","labelledLog","dispatch","get","call","time","trigger","_dispatch","detail","Math","min","seekableEnd","played","networkState","event","volume","muted","source","_ready","_getCanPlayDetail","duration","buffered","seekable","canPlay","readyState","started","loop","_onLoop","paused","_onTimeUpdate","ended","trunc","player","hasCustomControls","controls","playbackRate","error","message","code","mediaError","NativeAudioTracks","_context","_nativeTracks","onaddtrack","_onAddNativeTrack","onremovetrack","_onRemoveNativeTrack","onchange","_onChangeNativeTrack","audioTracks","_onChangeTrack","_track","track","label","audioTrack","id","language","kind","selected","_add","enabled","getById","_remove","enabledTrack","_getEnabledNativeTrack","_select","Array","from","find","current","getTrackById","prev","HTMLMediaProvider","scope","_currentSrc","setup","context","playsinline","load","currentSrc","hasAttribute","rate","play","pause","loadSource","src","preload","srcObject","URL","createObjectURL","H","R"],"mappings":"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","sourcesContent":["import { g as IS_SAFARI, h as isHLSSrc, j as getNumberOfDecimalPlaces, L as ListSymbol, k as isMediaStream } from './vidstack-e4c46e48.js';\nimport { y as isUndefined, A as isNumber, B as useDisposalBin, e as effect, o as onDispose, l as listenEvent, D as DOMEvent, E as isNil, F as createScope, f as setAttribute, k as isString } from './vidstack-b8ba7e3c.js';\n\nclass RAFLoop {\n  constructor(_callback) {\n    this._callback = _callback;\n  }\n  _start() {\n    if (!isUndefined(this._id))\n      return;\n    this._loop();\n  }\n  _stop() {\n    if (isNumber(this._id))\n      window.cancelAnimationFrame(this._id);\n    this._id = void 0;\n  }\n  _loop() {\n    this._id = window.requestAnimationFrame(() => {\n      if (isUndefined(this._id))\n        return;\n      this._callback();\n      this._loop();\n    });\n  }\n}\n\nclass HTMLMediaEvents {\n  constructor(_provider, _ctx) {\n    this._provider = _provider;\n    this._ctx = _ctx;\n    this._disposal = useDisposalBin();\n    this._waiting = false;\n    this._attachedLoadStart = false;\n    this._attachedCanPlay = false;\n    this._timeRAF = new RAFLoop(this._onRAF.bind(this));\n    this._handlers = /* @__PURE__ */ new Map() ;\n    this._handleDevEvent = this._onDevEvent.bind(this) ;\n    this._attachInitialListeners();\n    effect(this._attachTimeUpdate.bind(this));\n    onDispose(this._onDispose.bind(this));\n  }\n  get _media() {\n    return this._provider.media;\n  }\n  get _delegate() {\n    return this._ctx.delegate;\n  }\n  _onDispose() {\n    this._attachedLoadStart = false;\n    this._attachedCanPlay = false;\n    this._timeRAF._stop();\n    this._disposal.empty();\n  }\n  /**\n   * The `timeupdate` event fires surprisingly infrequently during playback, meaning your progress\n   * bar (or whatever else is synced to the currentTime) moves in a choppy fashion. This helps\n   * resolve that by retrieving time updates in a request animation frame loop.\n   */\n  _onRAF() {\n    const newTime = this._provider.currentTime;\n    if (this._ctx.$state.currentTime() !== newTime)\n      this._updateCurrentTime(newTime);\n  }\n  _attachInitialListeners() {\n    {\n      this._ctx.logger?.info(\"attaching initial listeners\");\n    }\n    this._attachEventListener(\"loadstart\", this._onLoadStart);\n    this._attachEventListener(\"abort\", this._onAbort);\n    this._attachEventListener(\"emptied\", this._onEmptied);\n    this._attachEventListener(\"error\", this._onError);\n    this._ctx.logger?.debug(\"attached initial media event listeners\");\n  }\n  _attachLoadStartListeners() {\n    if (this._attachedLoadStart)\n      return;\n    {\n      this._ctx.logger?.info(\"attaching load start listeners\");\n    }\n    this._disposal.add(\n      this._attachEventListener(\"loadeddata\", this._onLoadedData),\n      this._attachEventListener(\"loadedmetadata\", this._onLoadedMetadata),\n      this._attachEventListener(\"canplay\", this._onCanPlay),\n      this._attachEventListener(\"canplaythrough\", this._onCanPlayThrough),\n      this._attachEventListener(\"durationchange\", this._onDurationChange),\n      this._attachEventListener(\"play\", this._onPlay),\n      this._attachEventListener(\"progress\", this._onProgress),\n      this._attachEventListener(\"stalled\", this._onStalled),\n      this._attachEventListener(\"suspend\", this._onSuspend)\n    );\n    this._attachedLoadStart = true;\n  }\n  _attachCanPlayListeners() {\n    if (this._attachedCanPlay)\n      return;\n    {\n      this._ctx.logger?.info(\"attaching can play listeners\");\n    }\n    this._disposal.add(\n      this._attachEventListener(\"pause\", this._onPause),\n      this._attachEventListener(\"playing\", this._onPlaying),\n      this._attachEventListener(\"ratechange\", this._onRateChange),\n      this._attachEventListener(\"seeked\", this._onSeeked),\n      this._attachEventListener(\"seeking\", this._onSeeking),\n      this._attachEventListener(\"ended\", this._onEnded),\n      this._attachEventListener(\"volumechange\", this._onVolumeChange),\n      this._attachEventListener(\"waiting\", this._onWaiting)\n    );\n    this._attachedCanPlay = true;\n  }\n  _attachEventListener(eventType, handler) {\n    this._handlers.set(eventType, handler);\n    return listenEvent(\n      this._media,\n      eventType,\n      this._handleDevEvent \n    );\n  }\n  _onDevEvent(event2) {\n    this._ctx.logger?.debugGroup(`\\u{1F4FA} provider fired \\`${event2.type}\\``).labelledLog(\"Provider\", this._provider).labelledLog(\"Event\", event2).labelledLog(\"Media Store\", { ...this._ctx.$state }).dispatch();\n    this._handlers.get(event2.type)?.call(this, event2);\n  }\n  _updateCurrentTime(time, trigger) {\n    this._delegate._dispatch(\"time-update\", {\n      // Avoid errors where `currentTime` can have higher precision.\n      detail: {\n        currentTime: Math.min(time, this._ctx.$state.seekableEnd()),\n        played: this._media.played\n      },\n      trigger\n    });\n  }\n  _onLoadStart(event2) {\n    if (this._media.networkState === 3) {\n      this._onAbort(event2);\n      return;\n    }\n    this._attachLoadStartListeners();\n    this._delegate._dispatch(\"load-start\", { trigger: event2 });\n  }\n  _onAbort(event2) {\n    this._delegate._dispatch(\"abort\", { trigger: event2 });\n  }\n  _onEmptied() {\n    this._delegate._dispatch(\"emptied\", { trigger: event });\n  }\n  _onLoadedData(event2) {\n    this._delegate._dispatch(\"loaded-data\", { trigger: event2 });\n  }\n  _onLoadedMetadata(event2) {\n    this._attachCanPlayListeners();\n    this._delegate._dispatch(\"volume-change\", {\n      detail: {\n        volume: this._media.volume,\n        muted: this._media.muted\n      }\n    });\n    this._delegate._dispatch(\"loaded-metadata\", { trigger: event2 });\n    if (IS_SAFARI && isHLSSrc(this._ctx.$state.source())) {\n      this._delegate._ready(this._getCanPlayDetail(), event2);\n    }\n  }\n  _getCanPlayDetail() {\n    return {\n      duration: this._media.duration,\n      buffered: this._media.buffered,\n      seekable: this._media.seekable\n    };\n  }\n  _onPlay(event2) {\n    if (!this._ctx.$state.canPlay)\n      return;\n    this._delegate._dispatch(\"play\", { trigger: event2 });\n  }\n  _onPause(event2) {\n    if (this._media.readyState === 1 && !this._waiting)\n      return;\n    this._waiting = false;\n    this._timeRAF._stop();\n    this._delegate._dispatch(\"pause\", { trigger: event2 });\n  }\n  _onCanPlay(event2) {\n    this._delegate._ready(this._getCanPlayDetail(), event2);\n  }\n  _onCanPlayThrough(event2) {\n    if (this._ctx.$state.started())\n      return;\n    this._delegate._dispatch(\"can-play-through\", {\n      trigger: event2,\n      detail: this._getCanPlayDetail()\n    });\n  }\n  _onPlaying(event2) {\n    this._waiting = false;\n    this._delegate._dispatch(\"playing\", { trigger: event2 });\n    this._timeRAF._start();\n  }\n  _onStalled(event2) {\n    this._delegate._dispatch(\"stalled\", { trigger: event2 });\n    if (this._media.readyState < 3) {\n      this._waiting = true;\n      this._delegate._dispatch(\"waiting\", { trigger: event2 });\n    }\n  }\n  _onWaiting(event2) {\n    if (this._media.readyState < 3) {\n      this._waiting = true;\n      this._delegate._dispatch(\"waiting\", { trigger: event2 });\n    }\n  }\n  _onEnded(event2) {\n    this._timeRAF._stop();\n    this._updateCurrentTime(this._media.duration, event2);\n    this._delegate._dispatch(\"end\", { trigger: event2 });\n    if (this._ctx.$state.loop()) {\n      this._onLoop();\n    } else {\n      this._delegate._dispatch(\"ended\", { trigger: event2 });\n    }\n  }\n  _attachTimeUpdate() {\n    if (this._ctx.$state.paused()) {\n      listenEvent(this._media, \"timeupdate\", this._onTimeUpdate.bind(this));\n    }\n  }\n  _onTimeUpdate(event2) {\n    this._updateCurrentTime(this._media.currentTime, event2);\n  }\n  _onDurationChange(event2) {\n    if (this._ctx.$state.ended()) {\n      this._updateCurrentTime(this._media.duration, event2);\n    }\n    this._delegate._dispatch(\"duration-change\", {\n      detail: this._media.duration,\n      trigger: event2\n    });\n  }\n  _onVolumeChange(event2) {\n    this._delegate._dispatch(\"volume-change\", {\n      detail: {\n        volume: this._media.volume,\n        muted: this._media.muted\n      },\n      trigger: event2\n    });\n  }\n  _onSeeked(event2) {\n    this._updateCurrentTime(this._media.currentTime, event2);\n    this._delegate._dispatch(\"seeked\", {\n      detail: this._media.currentTime,\n      trigger: event2\n    });\n    if (Math.trunc(this._media.currentTime) === Math.trunc(this._media.duration) && getNumberOfDecimalPlaces(this._media.duration) > getNumberOfDecimalPlaces(this._media.currentTime)) {\n      this._updateCurrentTime(this._media.duration, event2);\n      if (!this._media.ended) {\n        this._ctx.player.dispatch(\n          new DOMEvent(\"media-play-request\", {\n            trigger: event2\n          })\n        );\n      }\n    }\n  }\n  _onSeeking(event2) {\n    this._delegate._dispatch(\"seeking\", {\n      detail: this._media.currentTime,\n      trigger: event2\n    });\n  }\n  _onProgress(event2) {\n    this._delegate._dispatch(\"progress\", {\n      detail: {\n        buffered: this._media.buffered,\n        seekable: this._media.seekable\n      },\n      trigger: event2\n    });\n  }\n  _onLoop() {\n    const hasCustomControls = isNil(this._media.controls);\n    if (hasCustomControls)\n      this._media.controls = false;\n    this._ctx.player.dispatch(new DOMEvent(\"media-loop-request\"));\n  }\n  _onSuspend(event2) {\n    this._delegate._dispatch(\"suspend\", { trigger: event2 });\n  }\n  _onRateChange(event2) {\n    this._delegate._dispatch(\"rate-change\", {\n      detail: this._media.playbackRate,\n      trigger: event2\n    });\n  }\n  _onError(event2) {\n    const error = this._media.error;\n    if (!error)\n      return;\n    this._delegate._dispatch(\"error\", {\n      detail: {\n        message: error.message,\n        code: error.code,\n        mediaError: error\n      },\n      trigger: event2\n    });\n  }\n}\n\nclass NativeAudioTracks {\n  constructor(_provider, _context) {\n    this._provider = _provider;\n    this._context = _context;\n    this._nativeTracks.onaddtrack = this._onAddNativeTrack.bind(this);\n    this._nativeTracks.onremovetrack = this._onRemoveNativeTrack.bind(this);\n    this._nativeTracks.onchange = this._onChangeNativeTrack.bind(this);\n    listenEvent(this._context.audioTracks, \"change\", this._onChangeTrack.bind(this));\n  }\n  get _nativeTracks() {\n    return this._provider.media.audioTracks;\n  }\n  _onAddNativeTrack(event) {\n    const _track = event.track;\n    if (_track.label === \"\")\n      return;\n    const audioTrack = {\n      id: _track.id + \"\",\n      label: _track.label,\n      language: _track.language,\n      kind: _track.kind,\n      selected: false\n    };\n    this._context.audioTracks[ListSymbol._add](audioTrack, event);\n    if (_track.enabled)\n      audioTrack.selected = true;\n  }\n  _onRemoveNativeTrack(event) {\n    const track = this._context.audioTracks.getById(event.track.id);\n    if (track)\n      this._context.audioTracks[ListSymbol._remove](track, event);\n  }\n  _onChangeNativeTrack(event) {\n    let enabledTrack = this._getEnabledNativeTrack();\n    if (!enabledTrack)\n      return;\n    const track = this._context.audioTracks.getById(enabledTrack.id);\n    if (track)\n      this._context.audioTracks[ListSymbol._select](track, true, event);\n  }\n  _getEnabledNativeTrack() {\n    return Array.from(this._nativeTracks).find((track) => track.enabled);\n  }\n  _onChangeTrack(event) {\n    const { current } = event.detail;\n    if (!current)\n      return;\n    const track = this._nativeTracks.getTrackById(current.id);\n    if (track) {\n      const prev = this._getEnabledNativeTrack();\n      if (prev)\n        prev.enabled = false;\n      track.enabled = true;\n    }\n  }\n}\n\nclass HTMLMediaProvider {\n  constructor(_media) {\n    this._media = _media;\n    this.scope = createScope();\n    this._currentSrc = null;\n  }\n  setup(context) {\n    new HTMLMediaEvents(this, context);\n    if (\"audioTracks\" in this.media)\n      new NativeAudioTracks(this, context);\n    this.playsinline = context.$state.playsinline();\n    onDispose(() => {\n      this._media.setAttribute(\"src\", \"\");\n      this._media.load();\n    });\n  }\n  get type() {\n    return \"\";\n  }\n  get media() {\n    return this._media;\n  }\n  get currentSrc() {\n    return this._currentSrc;\n  }\n  get paused() {\n    return this._media.paused;\n  }\n  get muted() {\n    return this._media.muted;\n  }\n  set muted(muted) {\n    this._media.muted = muted;\n  }\n  get volume() {\n    return this._media.volume;\n  }\n  set volume(volume) {\n    this._media.volume = volume;\n  }\n  get currentTime() {\n    return this._media.currentTime;\n  }\n  set currentTime(time) {\n    this._media.currentTime = time;\n  }\n  get playsinline() {\n    return this._media.hasAttribute(\"playsinline\");\n  }\n  set playsinline(playsinline) {\n    setAttribute(this._media, \"playsinline\", playsinline);\n  }\n  get playbackRate() {\n    return this._media.playbackRate;\n  }\n  set playbackRate(rate) {\n    this._media.playbackRate = rate;\n  }\n  async play() {\n    return this._media.play();\n  }\n  async pause() {\n    return this._media.pause();\n  }\n  async loadSource({ src, type }, preload) {\n    this._media.preload = preload || \"\";\n    if (isMediaStream(src)) {\n      this._media.srcObject = src;\n    } else {\n      this._media.srcObject = null;\n      this._media.src = isString(src) ? src : window.URL.createObjectURL(src);\n    }\n    this._media.load();\n    this._currentSrc = { src, type };\n  }\n}\n\nexport { HTMLMediaProvider as H, RAFLoop as R };\n"]},"metadata":{},"sourceType":"module"}