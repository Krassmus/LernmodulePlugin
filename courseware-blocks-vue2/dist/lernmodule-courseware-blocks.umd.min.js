(function(e,n){"object"===typeof exports&&"object"===typeof module?module.exports=n():"function"===typeof define&&define.amd?define([],n):"object"===typeof exports?exports["lernmodule-courseware-blocks"]=n():e["lernmodule-courseware-blocks"]=n()})("undefined"!==typeof self?self:this,(function(){return function(e){var n={};function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(o,i,function(n){return e[n]}.bind(null,i));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s="fae3")}({"0363":function(e,n,t){var o,i,r;(function(t){if("undefined"!==typeof window){var a=0,s=!1,c=!1,u="message",d=u.length,l="[iFrameSizer]",f=l.length,m=null,g=window.requestAnimationFrame,h=Object.freeze({max:1,scroll:1,bodyScroll:1,documentElementScroll:1}),p={},w=null,b=Object.freeze({autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,mouseEvents:!0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",onClose:function(){return!0},onClosed:function(){},onInit:function(){},onMessage:function(){C("onMessage function not defined")},onMouseEnter:function(){},onMouseLeave:function(){},onResized:function(){},onScroll:function(){return!0}}),y={};window.jQuery!==t&&Z(window.jQuery),i=[],o=K,r="function"===typeof o?o.apply(n,i):o,r===t||(e.exports=r),window.iFrameResize=window.iFrameResize||K()}function v(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function k(e,n,t){e.addEventListener(n,t,!1)}function I(e,n,t){e.removeEventListener(n,t,!1)}function x(){var e,n=["moz","webkit","o","ms"];for(e=0;e<n.length&&!g;e+=1)g=window[n[e]+"RequestAnimationFrame"];g?g=g.bind(window):T("setup","RequestAnimationFrame not supported")}function M(e){var n="Host page: "+e;return window.top!==window.self&&(n=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+e:"Nested host page: "+e),n}function E(e){return l+"["+M(e)+"]"}function O(e){return p[e]?p[e].log:s}function T(e,n){F("log",e,n,O(e))}function z(e,n){F("info",e,n,O(e))}function C(e,n){F("warn",e,n,!0)}function F(e,n,t,o){!0===o&&"object"===typeof window.console&&console[e](E(n),t)}function S(e){function n(){function e(){H(Q),N(X),S("onResized",Q)}r("Height"),r("Width"),D(e,Q,"init")}function t(){var e=_.slice(f).split(":"),n=e[1]?parseInt(e[1],10):0,t=p[e[0]]&&p[e[0]].iframe,r=getComputedStyle(t);return{iframe:t,id:e[0],height:n+o(r)+i(r),width:e[2],type:e[3]}}function o(e){if("border-box"!==e.boxSizing)return 0;var n=e.paddingTop?parseInt(e.paddingTop,10):0,t=e.paddingBottom?parseInt(e.paddingBottom,10):0;return n+t}function i(e){if("border-box"!==e.boxSizing)return 0;var n=e.borderTopWidth?parseInt(e.borderTopWidth,10):0,t=e.borderBottomWidth?parseInt(e.borderBottomWidth,10):0;return n+t}function r(e){var n=Number(p[X]["max"+e]),t=Number(p[X]["min"+e]),o=e.toLowerCase(),i=Number(Q[o]);T(X,"Checking "+o+" is in range "+t+"-"+n),i<t&&(i=t,T(X,"Set "+o+" to min value")),i>n&&(i=n,T(X,"Set "+o+" to max value")),Q[o]=""+i}function a(){function n(){function e(){var e=0,n=!1;for(T(X,"Checking connection is from allowed list of origins: "+o);e<o.length;e++)if(o[e]===t){n=!0;break}return n}function n(){var e=p[X]&&p[X].remoteHost;return T(X,"Checking connection is from: "+e),t===e}return o.constructor===Array?e():n()}var t=e.origin,o=p[X]&&p[X].checkOrigin;if(o&&""+t!=="null"&&!n())throw new Error("Unexpected message received from: "+t+" for "+Q.iframe.id+". Message was: "+e.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}function s(){return l===(""+_).slice(0,f)&&_.slice(f).split(":")[0]in p}function c(){var e=Q.type in{true:1,false:1,undefined:1};return e&&T(X,"Ignoring init message from meta parent page"),e}function u(e){return _.slice(_.indexOf(":")+d+e)}function g(e){T(X,"onMessage passed: {iframe: "+Q.iframe.id+", message: "+e+"}"),S("onMessage",{iframe:Q.iframe,message:JSON.parse(e)}),T(X,"--")}function h(){var e=document.body.getBoundingClientRect(),n=Q.iframe.getBoundingClientRect();return JSON.stringify({iframeHeight:n.height,iframeWidth:n.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(n.top-e.top,10),offsetLeft:parseInt(n.left-e.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,documentHeight:document.documentElement.clientHeight,documentWidth:document.documentElement.clientWidth,windowHeight:window.innerHeight,windowWidth:window.innerWidth})}function w(e,n){function t(){A("Send Page Info","pageInfo:"+h(),e,n)}J(t,32,n)}function b(){function e(e,t){function i(){p[o]?w(p[o].iframe,o):n()}["scroll","resize"].forEach((function(n){T(o,e+n+" listener for sendPageInfo"),t(window,n,i)}))}function n(){e("Remove ",I)}function t(){e("Add ",k)}var o=X;t(),p[o]&&(p[o].stopPageInfo=n)}function y(){p[X]&&p[X].stopPageInfo&&(p[X].stopPageInfo(),delete p[X].stopPageInfo)}function v(){var e=!0;return null===Q.iframe&&(C(X,"IFrame ("+Q.id+") not found"),e=!1),e}function x(e){var n=e.getBoundingClientRect();return R(X),{x:Math.floor(Number(n.left)+Number(m.x)),y:Math.floor(Number(n.top)+Number(m.y))}}function M(e){function n(){m=r,E(),T(X,"--")}function t(){return{x:Number(Q.width)+i.x,y:Number(Q.height)+i.y}}function o(){window.parentIFrame?window.parentIFrame["scrollTo"+(e?"Offset":"")](r.x,r.y):C(X,"Unable to scroll to requested position, window.parentIFrame not found")}var i=e?x(Q.iframe):{x:0,y:0},r=t();T(X,"Reposition requested from iFrame (offset x:"+i.x+" y:"+i.y+")"),window.top===window.self?n():o()}function E(){!1===S("onScroll",m)?P():N(X)}function O(e){function n(){var e=x(r);T(X,"Moving to in page link (#"+o+") at x: "+e.x+" y: "+e.y),m={x:e.x,y:e.y},E(),T(X,"--")}function t(){window.parentIFrame?window.parentIFrame.moveToAnchor(o):T(X,"In page link #"+o+" not found and window.parentIFrame not found")}var o=e.split("#")[1]||"",i=decodeURIComponent(o),r=document.getElementById(i)||document.getElementsByName(i)[0];r?n():window.top===window.self?T(X,"In page link #"+o+" not found"):t()}function F(e){var n={};if(0===Number(Q.width)&&0===Number(Q.height)){var t=u(9).split(":");n={x:t[1],y:t[0]}}else n={x:Q.width,y:Q.height};S(e,{iframe:Q.iframe,screenX:Number(n.x),screenY:Number(n.y),type:Q.type})}function S(e,n){return W(X,e,n)}function B(){switch(p[X]&&p[X].firstRun&&$(),Q.type){case"close":j(Q.iframe);break;case"message":g(u(6));break;case"mouseenter":F("onMouseEnter");break;case"mouseleave":F("onMouseLeave");break;case"autoResize":p[X].autoResize=JSON.parse(u(9));break;case"scrollTo":M(!1);break;case"scrollToOffset":M(!0);break;case"pageInfo":w(p[X]&&p[X].iframe,X),b();break;case"pageInfoStop":y();break;case"inPageLink":O(u(9));break;case"reset":L(Q);break;case"init":n(),S("onInit",Q.iframe);break;default:0===Number(Q.width)&&0===Number(Q.height)?C("Unsupported message received ("+Q.type+"), this is likely due to the iframe containing a later version of iframe-resizer than the parent page"):n()}}function q(e){var n=!0;return p[e]||(n=!1,C(Q.type+" No settings for "+e+". Message was: "+_)),n}function V(){for(var e in p)A("iFrame requested init",U(e),p[e].iframe,e)}function $(){p[X]&&(p[X].firstRun=!1)}var _=e.data,Q={},X=null;"[iFrameResizerChild]Ready"===_?V():s()?(Q=t(),X=Q.id,p[X]&&(p[X].loaded=!0),!c()&&q(X)&&(T(X,"Received: "+_),v()&&a()&&B())):z(X,"Ignored: "+_)}function W(e,n,t){var o=null,i=null;if(p[e]){if(o=p[e][n],"function"!==typeof o)throw new TypeError(n+" on iFrame["+e+"] is not a function");i=o(t)}return i}function B(e){var n=e.id;delete p[n]}function j(e){var n=e.id;if(!1!==W(n,"onClose",n)){T(n,"Removing iFrame: "+n);try{e.parentNode&&e.parentNode.removeChild(e)}catch(t){C(t)}W(n,"onClosed",n),T(n,"--"),B(e)}else T(n,"Close iframe cancelled by onClose event")}function R(e){null===m&&(m={x:window.pageXOffset===t?document.documentElement.scrollLeft:window.pageXOffset,y:window.pageYOffset===t?document.documentElement.scrollTop:window.pageYOffset},T(e,"Get page position: "+m.x+","+m.y))}function N(e){null!==m&&(window.scrollTo(m.x,m.y),T(e,"Set page position: "+m.x+","+m.y),P())}function P(){m=null}function L(e){function n(){H(e),A("reset","reset",e.iframe,e.id)}T(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),R(e.id),D(n,e,"reset")}function H(e){function n(n){e.id?(e.iframe.style[n]=e[n]+"px",T(e.id,"IFrame ("+i+") "+n+" set to "+e[n]+"px")):T("undefined","messageData id not set")}function t(n){c||"0"!==e[n]||(c=!0,T(i,"Hidden iFrame detected, creating visibility listener"),_())}function o(e){n(e),t(e)}var i=e.iframe.id;p[i]&&(p[i].sizeHeight&&o("height"),p[i].sizeWidth&&o("width"))}function D(e,n,t){t!==n.type&&g&&!window.jasmine?(T(n.id,"Requesting animation frame"),g(e)):e()}function A(e,n,t,o,i){function r(){var i=p[o]&&p[o].targetOrigin;T(o,"["+e+"] Sending msg to iframe["+o+"] ("+n+") targetOrigin: "+i),t.contentWindow.postMessage(l+n,i)}function a(){C(o,"["+e+"] IFrame("+o+") not found")}function s(){t&&"contentWindow"in t&&null!==t.contentWindow?r():a()}function c(){function e(){!p[o]||p[o].loaded||u||(u=!0,C(o,"IFrame has not responded within "+p[o].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ignored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))}i&&p[o]&&p[o].warningTimeout&&(p[o].msgTimeout=setTimeout(e,p[o].warningTimeout))}var u=!1;o=o||t.id,p[o]&&(s(),c())}function U(e){return e+":"+p[e].bodyMarginV1+":"+p[e].sizeWidth+":"+p[e].log+":"+p[e].interval+":"+p[e].enablePublicMethods+":"+p[e].autoResize+":"+p[e].bodyMargin+":"+p[e].heightCalculationMethod+":"+p[e].bodyBackground+":"+p[e].bodyPadding+":"+p[e].tolerance+":"+p[e].inPageLinks+":"+p[e].resizeFrom+":"+p[e].widthCalculationMethod+":"+p[e].mouseEvents}function q(e){return"number"===typeof e}function V(e,n){function o(){function n(n){var t=p[M][n];1/0!==t&&0!==t&&(e.style[n]=q(t)?t+"px":t,T(M,"Set "+n+" = "+e.style[n]))}function t(e){if(p[M]["min"+e]>p[M]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}t("Height"),t("Width"),n("maxHeight"),n("minHeight"),n("maxWidth"),n("minWidth")}function i(){var e=n&&n.id||b.id+a++;return null!==document.getElementById(e)&&(e+=a++),e}function r(t){if("string"!==typeof t)throw new TypeError("Invaild id for iFrame. Expected String");return""===t&&(e.id=t=i(),s=(n||{}).log,T(t,"Added missing iframe ID: "+t+" ("+e.src+")")),t}function c(){switch(T(M,"IFrame scrolling "+(p[M]&&p[M].scrolling?"enabled":"disabled")+" for "+M),e.style.overflow=!1===(p[M]&&p[M].scrolling)?"hidden":"auto",p[M]&&p[M].scrolling){case"omit":break;case!0:e.scrolling="yes";break;case!1:e.scrolling="no";break;default:e.scrolling=p[M]?p[M].scrolling:"no"}}function u(){"number"!==typeof(p[M]&&p[M].bodyMargin)&&"0"!==(p[M]&&p[M].bodyMargin)||(p[M].bodyMarginV1=p[M].bodyMargin,p[M].bodyMargin=p[M].bodyMargin+"px")}function d(){var n=p[M]&&p[M].firstRun,t=p[M]&&p[M].heightCalculationMethod in h;!n&&t&&L({iframe:e,height:0,width:0,type:"init"})}function l(){p[M]&&(p[M].iframe.iFrameResizer={close:j.bind(null,p[M].iframe),removeListeners:B.bind(null,p[M].iframe),resize:A.bind(null,"Window resize","resize",p[M].iframe),moveToAnchor:function(e){A("Move to anchor","moveToAnchor:"+e,p[M].iframe,M)},sendMessage:function(e){e=JSON.stringify(e),A("Send Message","message:"+e,p[M].iframe,M)}})}function f(n){function o(){A("iFrame.onload",n,e,t,!0),d()}function i(n){if(e.parentNode){var t=new n((function(n){n.forEach((function(n){var t=Array.prototype.slice.call(n.removedNodes);t.forEach((function(n){n===e&&j(e)}))}))}));t.observe(e.parentNode,{childList:!0})}}var r=v();r&&i(r),k(e,"load",o),A("init",n,e,t,!0)}function m(e){if("object"!==typeof e)throw new TypeError("Options is not an object")}function g(e){for(var n in b)Object.prototype.hasOwnProperty.call(b,n)&&(p[M][n]=Object.prototype.hasOwnProperty.call(e,n)?e[n]:b[n])}function w(e){return""===e||null!==e.match(/^(about:blank|javascript:|file:\/\/)/)?"*":e}function y(e){var n=e.split("Callback");if(2===n.length){var t="on"+n[0].charAt(0).toUpperCase()+n[0].slice(1);this[t]=this[e],delete this[e],C(M,"Deprecated: '"+e+"' has been renamed '"+t+"'. The old method will be removed in the next major version.")}}function I(n){n=n||{},p[M]=Object.create(null),p[M].iframe=e,p[M].firstRun=!0,p[M].remoteHost=e.src&&e.src.split("/").slice(0,3).join("/"),m(n),Object.keys(n).forEach(y,n),g(n),p[M]&&(p[M].targetOrigin=!0===p[M].checkOrigin?w(p[M].remoteHost):"*")}function x(){return M in p&&"iFrameResizer"in e}var M=r(e.id);x()?C(M,"Ignored iFrame, already setup."):(I(n),c(),o(),u(),f(U(M)),l())}function $(e,n){null===w&&(w=setTimeout((function(){w=null,e()}),n))}function J(e,n,t){y[t]||(y[t]=setTimeout((function(){y[t]=null,e()}),n))}function _(){function e(){function e(e){function n(n){return"0px"===(p[e]&&p[e].iframe.style[n])}function t(e){return null!==e.offsetParent}p[e]&&t(p[e].iframe)&&(n("height")||n("width"))&&A("Visibility change","resize",p[e].iframe,e)}Object.keys(p).forEach((function(n){e(n)}))}function n(n){T("window","Mutation observed: "+n[0].target+" "+n[0].type),$(e,16)}function t(){var e=document.querySelector("body"),t={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0},i=new o(n);i.observe(e,t)}var o=v();o&&t()}function Q(e){function n(){Y("Window "+e,"resize")}T("window","Trigger event: "+e),$(n,16)}function X(){function e(){Y("Tab Visible","resize")}"hidden"!==document.visibilityState&&(T("document","Trigger event: Visibility change"),$(e,16))}function Y(e,n){function t(e){return p[e]&&"parent"===p[e].resizeFrom&&p[e].autoResize&&!p[e].firstRun}Object.keys(p).forEach((function(o){t(o)&&A(e,n,p[o].iframe,o)}))}function G(){k(window,"message",S),k(window,"resize",(function(){Q("resize")})),k(document,"visibilitychange",X),k(document,"-webkit-visibilitychange",X)}function K(){function e(e,n){function t(){if(!n.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==n.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+n.tagName+">")}n&&(t(),V(n,e),o.push(n))}function n(e){e&&e.enablePublicMethods&&C("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}var o;return x(),G(),function(i,r){switch(o=[],n(i),typeof r){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(r||"iframe"),e.bind(t,i));break;case"object":e(i,r);break;default:throw new TypeError("Unexpected data type ("+typeof r+")")}return o}}function Z(e){e.fn?e.fn.iFrameResize||(e.fn.iFrameResize=function(e){function n(n,t){V(t,e)}return this.filter("iframe").each(n).end()}):z("","Unable to bind to jQuery, it is not fully loaded.")}})()},fae3:function(e,n,t){"use strict";if(t.r(n),"undefined"!==typeof window){var o=window.document.currentScript,i=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(t.p=i[1])}var r=t("0363"),a=t.n(r),s={name:"LernmoduleCoursewareBlockBase",inject:["coursewarePluginComponents"],props:{block:{type:Object,required:!0},canEdit:{type:Boolean,required:!0},isTeacher:{type:Boolean,required:!0}},computed:{iframeUrl(){return window.STUDIP.LernmoduleCoursewareBlocksPlugin.editorUrl},isBlockInitialized(){return this.block.attributes.payload.initialized}},created(){window.addEventListener("message",this.onWindowMessage)},beforeDestroy(){window.removeEventListener("message",this.onWindowMessage)},methods:{onWindowMessage(e){if(e.source===this.$refs.lernmoduleIframe.contentWindow&&e.data&&Object.hasOwn(e.data,"type"))switch(e.data.type){case"SaveCoursewareBlock":console.log("got message posted to window: ",e,"saving courseware block. taskDefinition: ",e.data.taskDefinition),this.storeBlock(e.data.taskDefinition);break;case"CancelEditingCoursewareBlock":console.log("got message posted to window: ",e,"canceling editing."),this.$refs.defaultBlock.closeEdit(),this.$refs.lernmoduleIframe.contentWindow.location.reload();break}},onShowEditChange(e){this.$refs.lernmoduleIframe.contentWindow.postMessage({type:"ShowEditChange",state:e})},onIframeLoad(){console.log("on iframe load"),a()({heightCalculationMethod:"taggedElement"},this.$refs.lernmoduleIframe);const e={type:"InitializeCoursewareBlock",...window.STUDIP.CoursewareLernmoduleBlocksPlugin,canEdit:this.canEdit,isTeacher:this.isTeacher,block:JSON.parse(JSON.stringify(this.block)),context:JSON.parse(JSON.stringify(this.$store.getters.context))};this.$refs.lernmoduleIframe.contentWindow.postMessage(e),console.log("iframe loaded, calling onShowEditChange..."),this.onShowEditChange(this.$refs.defaultBlock.showEdit)},storeBlock(e){const n={...this.block.attributes,payload:{initialized:!0,task_json:e}};this.$store.dispatch("updateBlockInContainer",{attributes:n,blockId:this.block.id,containerId:this.block.relationships.container.data.id}).then(()=>{this.$refs.defaultBlock.displayFeature(!1)})}},template:'\n    <component\n      class="cw-lernmodule-block cw-block"\n      :is="coursewarePluginComponents.CoursewareDefaultBlock"\n      ref="defaultBlock"\n      :block="block"\n      :canEdit="canEdit"\n      :isTeacher="isTeacher"\n      :preview="true"\n      :defaultGrade="false"\n      @storeEdit="storeBlock"\n      @showEdit="onShowEditChange"\n    >\n      <template #content>\n        <template v-if="false">\n          <p>Lernmodule block content. Block:</p>\n          <pre style="font-size: 8px">{{ block }}</pre>\n        </template>\n        <iframe\n          ref="lernmoduleIframe"\n          class="lernmodule-iframe"\n          :src="iframeUrl"\n          @load="onIframeLoad"\n        />\n      </template>\n    </component>\n  '};const c=["DragTheWords","FillInTheBlanks","FindTheHotspots","FindTheWords","LmbInteractiveVideo","MarkTheWords","Memory","Pairing","Question","Sequencing"],u=window.STUDIP.LernmoduleCoursewareBlocksPlugin.debug;function d(e){return`Courseware${e}Block`}async function l(){const e=await window.STUDIP.Vue.load().then(e=>e.createApp().version);return u&&console.log(e?"Detected vue 3":"Detected vue 2"),e}u&&console.log("Hello :) Adding event handler to add Lernmodule blocks in Courseware..."),window.STUDIP.eventBus.on("courseware:init-plugin-manager",async e=>{const n=await l();for(const t of c){const o=d(t),i={name:o,extends:s},r=n?window.Vue.defineAsyncComponent(async()=>i):i;e.addBlock(o,r),u&&console.info("Registered CW block component: ",o)}})}})}));
//# sourceMappingURL=lernmodule-courseware-blocks.umd.min.js.map