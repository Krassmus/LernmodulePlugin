{"remainingRequest":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/src/components/LernmoduleCoursewareBlockBase.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/src/components/LernmoduleCoursewareBlockBase.vue","mtime":1701252452333},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBpZnJhbWVSZXNpemUgZnJvbSAnaWZyYW1lLXJlc2l6ZXIvanMvaWZyYW1lUmVzaXplcic7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ0xlcm5tb2R1bGVDb3Vyc2V3YXJlQmxvY2tCYXNlJywKICBpbmplY3Q6IFsnY291cnNld2FyZVBsdWdpbkNvbXBvbmVudHMnXSwKICBwcm9wczogewogICAgYmxvY2s6IHsKICAgICAgdHlwZTogT2JqZWN0LAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCiAgICBjYW5FZGl0OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIHJlcXVpcmVkOiB0cnVlLAogICAgfSwKICAgIGlzVGVhY2hlcjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICByZXF1aXJlZDogdHJ1ZSwKICAgIH0sCiAgfSwKICBjb21wdXRlZDogewogICAgaWZyYW1lVXJsKCkgewogICAgICByZXR1cm4gd2luZG93LlNUVURJUC5MZXJubW9kdWxlQ291cnNld2FyZUJsb2Nrc1BsdWdpbi5lZGl0b3JVcmw7CiAgICB9LAogICAgaXNCbG9ja0luaXRpYWxpemVkKCkgewogICAgICByZXR1cm4gdGhpcy5ibG9jay5hdHRyaWJ1dGVzLnBheWxvYWQuaW5pdGlhbGl6ZWQ7CiAgICB9LAogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbldpbmRvd01lc3NhZ2UpOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbldpbmRvd01lc3NhZ2UpOwogIH0sCiAgbWV0aG9kczogewogICAgLy8gSGFuZGxlIG1lc3NhZ2VzIHBvc3RlZCB0byBvdXIgd2luZG93IGZyb20gb3VyIGlmcmFtZQogICAgb25XaW5kb3dNZXNzYWdlKG1lc3NhZ2UpIHsKICAgICAgaWYgKG1lc3NhZ2Uuc291cmNlICE9PSB0aGlzLiRyZWZzLmxlcm5tb2R1bGVJZnJhbWUuY29udGVudFdpbmRvdykgewogICAgICAgIHJldHVybjsgLy8gSWdub3JlIHRoZSBtZXNzYWdlIC0tIGl0J3Mgbm90IGZyb20gb3VyIGlmcmFtZQogICAgICB9CiAgICAgIGlmIChtZXNzYWdlLmRhdGEgJiYgbWVzc2FnZS5kYXRhLmhhc093blByb3BlcnR5KCd0eXBlJykpIHsKICAgICAgICBzd2l0Y2ggKG1lc3NhZ2UuZGF0YS50eXBlKSB7CiAgICAgICAgICBjYXNlICdTYXZlQ291cnNld2FyZUJsb2NrJzoKICAgICAgICAgICAgY29uc29sZS5sb2coCiAgICAgICAgICAgICAgJ2dvdCBtZXNzYWdlIHBvc3RlZCB0byB3aW5kb3c6ICcsCiAgICAgICAgICAgICAgbWVzc2FnZSwKICAgICAgICAgICAgICAnc2F2aW5nIGNvdXJzZXdhcmUgYmxvY2suIHRhc2tEZWZpbml0aW9uOiAnLAogICAgICAgICAgICAgIG1lc3NhZ2UuZGF0YS50YXNrRGVmaW5pdGlvbgogICAgICAgICAgICApOwogICAgICAgICAgICB0aGlzLnN0b3JlQmxvY2sobWVzc2FnZS5kYXRhLnRhc2tEZWZpbml0aW9uKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdDYW5jZWxFZGl0aW5nQ291cnNld2FyZUJsb2NrJzoKICAgICAgICAgICAgY29uc29sZS5sb2coCiAgICAgICAgICAgICAgJ2dvdCBtZXNzYWdlIHBvc3RlZCB0byB3aW5kb3c6ICcsCiAgICAgICAgICAgICAgbWVzc2FnZSwKICAgICAgICAgICAgICAnY2FuY2VsaW5nIGVkaXRpbmcuJwogICAgICAgICAgICApOwogICAgICAgICAgICAvLyBjbG9zZSB0aGUgZWRpdCBtZW51CiAgICAgICAgICAgIHRoaXMuJHJlZnMuZGVmYXVsdEJsb2NrLmNsb3NlRWRpdCgpOwogICAgICAgICAgICAvLyBSZWxvYWQgdGhlIGlmcmFtZSAodGhpcyBjYXVzZXMgdGhlIHN0YXRlIG9mIHRoZSBibG9jayB0byByZXNldCB0byBob3cKICAgICAgICAgICAgLy8gaXQgaXMgb24gdGhlIHNlcnZlciwgZGlzY2FyZGluZyB1c2VyJ3MgdW5zYXZlZCBjaGFuZ2VzKS4KICAgICAgICAgICAgdGhpcy4kcmVmcy5sZXJubW9kdWxlSWZyYW1lLmNvbnRlbnRXaW5kb3cubG9jYXRpb24ucmVsb2FkKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIC8vIFBhc3MgdGhlIGNoaWxkIENvdXJzZXdhcmVEZWZhdWx0QmxvY2sncyBlZGl0aW5nIHN0YXRlIG9uIHRvIG91ciBpRnJhbWUuCiAgICAvLyBUaGlzIGxldHMgb3VyIFZ1ZSAzIGNvbXBvbmVudCBrbm93IHdoZXRoZXIgdG8gaGlkZS9zaG93IGl0cyBlZGl0aW5nIFVJCiAgICBvblNob3dFZGl0Q2hhbmdlKHN0YXRlKSB7CiAgICAgIHRoaXMuJHJlZnMubGVybm1vZHVsZUlmcmFtZS5jb250ZW50V2luZG93LnBvc3RNZXNzYWdlKHsKICAgICAgICB0eXBlOiAnU2hvd0VkaXRDaGFuZ2UnLAogICAgICAgIHN0YXRlLAogICAgICB9KTsKICAgIH0sCiAgICBvbklmcmFtZUxvYWQoZXZlbnQpIHsKICAgICAgY29uc29sZS5sb2coJ29uIGlmcmFtZSBsb2FkJyk7CiAgICAgIC8vIENvbmZpZ3VyZSBpRnJhbWVSZXNpemUgdG8gcmVzaXplIHRoZSBpZnJhbWUgdG8gdGhlIGhlaWdodCBvZiB0aGUKICAgICAgLy8gI2FwcCBlbGVtZW50LCB3aGljaCBpcyBtYXJrZWQgd2l0aCBkYXRhLWlmcmFtZS1oZWlnaHQsIGluc2lkZSB0aGUgaWZyYW1lCiAgICAgIGlmcmFtZVJlc2l6ZSgKICAgICAgICB7IGhlaWdodENhbGN1bGF0aW9uTWV0aG9kOiAndGFnZ2VkRWxlbWVudCcgfSwKICAgICAgICB0aGlzLiRyZWZzLmxlcm5tb2R1bGVJZnJhbWUKICAgICAgKTsKCiAgICAgIC8vIFNlbmQgbWVzc2FnZSB0byBpbml0aWFsaXplIHRoZSBWdWUgMyBjb3Vyc2V3YXJlIGJsb2NrJ3Mgc3RvcmUKICAgICAgdGhpcy4kcmVmcy5sZXJubW9kdWxlSWZyYW1lLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoewogICAgICAgIHR5cGU6ICdJbml0aWFsaXplQ291cnNld2FyZUJsb2NrJywKICAgICAgICAuLi53aW5kb3cuU1RVRElQLkNvdXJzZXdhcmVMZXJubW9kdWxlQmxvY2tzUGx1Z2luLAogICAgICAgIGNhbkVkaXQ6IHRoaXMuY2FuRWRpdCwKICAgICAgICBpc1RlYWNoZXI6IHRoaXMuaXNUZWFjaGVyLAogICAgICAgIGJsb2NrOiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMuYmxvY2spKSwKICAgICAgfSk7CgogICAgICAvLyBDYWxsIG9uU2hvd0VkaXRDaGFuZ2Ugb25lIHRpbWUgYWZ0ZXIgbG9hZCB0byBpbml0aWFsaXplIHRoZSAnZWRpdGluZycKICAgICAgLy8gc3RhdGUgaW4gb3VyIFZ1ZSAzIGNvbXBvbmVudAogICAgICBjb25zb2xlLmxvZygnaWZyYW1lIGxvYWRlZCwgY2FsbGluZyBvblNob3dFZGl0Q2hhbmdlLi4uJyk7CiAgICAgIHRoaXMub25TaG93RWRpdENoYW5nZSh0aGlzLiRyZWZzLmRlZmF1bHRCbG9jay5zaG93RWRpdCk7CiAgICB9LAogICAgc3RvcmVCbG9jayh0YXNrRGVmaW5pdGlvbikgewogICAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICAgIC4uLnRoaXMuYmxvY2suYXR0cmlidXRlcywKICAgICAgICBwYXlsb2FkOiB7CiAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZSwKICAgICAgICAgIHRhc2tfanNvbjogdGFza0RlZmluaXRpb24sCiAgICAgICAgfSwKICAgICAgfTsKCiAgICAgIHRoaXMuJHN0b3JlCiAgICAgICAgLmRpc3BhdGNoKCd1cGRhdGVCbG9ja0luQ29udGFpbmVyJywgewogICAgICAgICAgYXR0cmlidXRlcywKICAgICAgICAgIGJsb2NrSWQ6IHRoaXMuYmxvY2suaWQsCiAgICAgICAgICBjb250YWluZXJJZDogdGhpcy5ibG9jay5yZWxhdGlvbnNoaXBzLmNvbnRhaW5lci5kYXRhLmlkLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgLy8gY2xvc2UgdGhlIGVkaXQgbWVudQogICAgICAgICAgdGhpcy4kcmVmcy5kZWZhdWx0QmxvY2suZGlzcGxheUZlYXR1cmUoZmFsc2UpOwogICAgICAgIH0pOwogICAgfSwKICB9LAp9Owo="},{"version":3,"sources":["LernmoduleCoursewareBlockBase.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LernmoduleCoursewareBlockBase.vue","sourceRoot":"src/components","sourcesContent":["<!--\nThis component embeds the Vue 3 component 'CoursewareBlock'\n(vue/src/components/CoursewareBlock.vue) using an iframe.\nThis enables us to write our Lernmodule Courseware blocks in Vue 3, although\nthe Stud.IP core is using Vue 2.\nWe resize the iframe automatically to fit its contents, and we pass messages\nback and forth with the iframe window in order to load and save the block,\nhide/show its editing UI, and so on.\n-->\n<template>\n  <component\n    class=\"cw-lernmodule-block\"\n    :is=\"coursewarePluginComponents.CoursewareDefaultBlock\"\n    ref=\"defaultBlock\"\n    :block=\"block\"\n    :canEdit=\"canEdit\"\n    :isTeacher=\"isTeacher\"\n    :preview=\"true\"\n    :defaultGrade=\"false\"\n    @storeEdit=\"storeBlock\"\n    @showEdit=\"onShowEditChange\"\n  >\n    <template #content>\n      <template v-if=\"false\">\n        <p>Lernmodule block content. Block:</p>\n        <pre style=\"font-size: 8px\">{{ block }}</pre>\n      </template>\n      <iframe\n        ref=\"lernmoduleIframe\"\n        class=\"lernmodule-iframe\"\n        :src=\"iframeUrl\"\n        @load=\"onIframeLoad\"\n      />\n    </template>\n  </component>\n</template>\n\n<style>\n.lernmodule-iframe {\n  width: 1px;\n  min-width: 100%;\n  border: none;\n}\n/* Hide CoursewareDefaultBlock's 'edit' section */\n.cw-default-block.cw-lernmodule-block .cw-block-edit {\n  display: none;\n}\n</style>\n\n<script>\nimport iframeResize from 'iframe-resizer/js/iframeResizer';\n\nexport default {\n  name: 'LernmoduleCoursewareBlockBase',\n  inject: ['coursewarePluginComponents'],\n  props: {\n    block: {\n      type: Object,\n      required: true,\n    },\n    canEdit: {\n      type: Boolean,\n      required: true,\n    },\n    isTeacher: {\n      type: Boolean,\n      required: true,\n    },\n  },\n  computed: {\n    iframeUrl() {\n      return window.STUDIP.LernmoduleCoursewareBlocksPlugin.editorUrl;\n    },\n    isBlockInitialized() {\n      return this.block.attributes.payload.initialized;\n    },\n  },\n  created() {\n    window.addEventListener('message', this.onWindowMessage);\n  },\n  beforeDestroy() {\n    window.removeEventListener('message', this.onWindowMessage);\n  },\n  methods: {\n    // Handle messages posted to our window from our iframe\n    onWindowMessage(message) {\n      if (message.source !== this.$refs.lernmoduleIframe.contentWindow) {\n        return; // Ignore the message -- it's not from our iframe\n      }\n      if (message.data && message.data.hasOwnProperty('type')) {\n        switch (message.data.type) {\n          case 'SaveCoursewareBlock':\n            console.log(\n              'got message posted to window: ',\n              message,\n              'saving courseware block. taskDefinition: ',\n              message.data.taskDefinition\n            );\n            this.storeBlock(message.data.taskDefinition);\n            break;\n          case 'CancelEditingCoursewareBlock':\n            console.log(\n              'got message posted to window: ',\n              message,\n              'canceling editing.'\n            );\n            // close the edit menu\n            this.$refs.defaultBlock.closeEdit();\n            // Reload the iframe (this causes the state of the block to reset to how\n            // it is on the server, discarding user's unsaved changes).\n            this.$refs.lernmoduleIframe.contentWindow.location.reload();\n            break;\n        }\n      }\n    },\n    // Pass the child CoursewareDefaultBlock's editing state on to our iFrame.\n    // This lets our Vue 3 component know whether to hide/show its editing UI\n    onShowEditChange(state) {\n      this.$refs.lernmoduleIframe.contentWindow.postMessage({\n        type: 'ShowEditChange',\n        state,\n      });\n    },\n    onIframeLoad(event) {\n      console.log('on iframe load');\n      // Configure iFrameResize to resize the iframe to the height of the\n      // #app element, which is marked with data-iframe-height, inside the iframe\n      iframeResize(\n        { heightCalculationMethod: 'taggedElement' },\n        this.$refs.lernmoduleIframe\n      );\n\n      // Send message to initialize the Vue 3 courseware block's store\n      this.$refs.lernmoduleIframe.contentWindow.postMessage({\n        type: 'InitializeCoursewareBlock',\n        ...window.STUDIP.CoursewareLernmoduleBlocksPlugin,\n        canEdit: this.canEdit,\n        isTeacher: this.isTeacher,\n        block: JSON.parse(JSON.stringify(this.block)),\n      });\n\n      // Call onShowEditChange one time after load to initialize the 'editing'\n      // state in our Vue 3 component\n      console.log('iframe loaded, calling onShowEditChange...');\n      this.onShowEditChange(this.$refs.defaultBlock.showEdit);\n    },\n    storeBlock(taskDefinition) {\n      const attributes = {\n        ...this.block.attributes,\n        payload: {\n          initialized: true,\n          task_json: taskDefinition,\n        },\n      };\n\n      this.$store\n        .dispatch('updateBlockInContainer', {\n          attributes,\n          blockId: this.block.id,\n          containerId: this.block.relationships.container.data.id,\n        })\n        .then(() => {\n          // close the edit menu\n          this.$refs.defaultBlock.displayFeature(false);\n        });\n    },\n  },\n};\n</script>\n"]}]}