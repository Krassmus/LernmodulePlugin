{"remainingRequest":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/thread-loader/dist/cjs.js!/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/babel-loader/lib/index.js!/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/cache-loader/dist/cjs.js??ref--1-0!/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/src/components/LernmoduleCoursewareBlockBase.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/src/components/LernmoduleCoursewareBlockBase.vue","mtime":1701252452333},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/babel-loader/lib/index.js","mtime":456789000000},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/ann/dev/studip/54/public/plugins_packages/RasmusFuhse/LernmodulePlugin/courseware-blocks-vue2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBpZnJhbWVSZXNpemUgZnJvbSAnaWZyYW1lLXJlc2l6ZXIvanMvaWZyYW1lUmVzaXplcic7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnTGVybm1vZHVsZUNvdXJzZXdhcmVCbG9ja0Jhc2UnLAogIGluamVjdDogWydjb3Vyc2V3YXJlUGx1Z2luQ29tcG9uZW50cyddLAogIHByb3BzOiB7CiAgICBibG9jazogewogICAgICB0eXBlOiBPYmplY3QsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgY2FuRWRpdDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGlzVGVhY2hlcjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIGlmcmFtZVVybCgpIHsKICAgICAgcmV0dXJuIHdpbmRvdy5TVFVESVAuTGVybm1vZHVsZUNvdXJzZXdhcmVCbG9ja3NQbHVnaW4uZWRpdG9yVXJsOwogICAgfSwKICAgIGlzQmxvY2tJbml0aWFsaXplZCgpIHsKICAgICAgcmV0dXJuIHRoaXMuYmxvY2suYXR0cmlidXRlcy5wYXlsb2FkLmluaXRpYWxpemVkOwogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbldpbmRvd01lc3NhZ2UpOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgdGhpcy5vbldpbmRvd01lc3NhZ2UpOwogIH0sCiAgbWV0aG9kczogewogICAgLy8gSGFuZGxlIG1lc3NhZ2VzIHBvc3RlZCB0byBvdXIgd2luZG93IGZyb20gb3VyIGlmcmFtZQogICAgb25XaW5kb3dNZXNzYWdlKG1lc3NhZ2UpIHsKICAgICAgaWYgKG1lc3NhZ2Uuc291cmNlICE9PSB0aGlzLiRyZWZzLmxlcm5tb2R1bGVJZnJhbWUuY29udGVudFdpbmRvdykgewogICAgICAgIHJldHVybjsgLy8gSWdub3JlIHRoZSBtZXNzYWdlIC0tIGl0J3Mgbm90IGZyb20gb3VyIGlmcmFtZQogICAgICB9CgogICAgICBpZiAobWVzc2FnZS5kYXRhICYmIG1lc3NhZ2UuZGF0YS5oYXNPd25Qcm9wZXJ0eSgndHlwZScpKSB7CiAgICAgICAgc3dpdGNoIChtZXNzYWdlLmRhdGEudHlwZSkgewogICAgICAgICAgY2FzZSAnU2F2ZUNvdXJzZXdhcmVCbG9jayc6CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnb3QgbWVzc2FnZSBwb3N0ZWQgdG8gd2luZG93OiAnLCBtZXNzYWdlLCAnc2F2aW5nIGNvdXJzZXdhcmUgYmxvY2suIHRhc2tEZWZpbml0aW9uOiAnLCBtZXNzYWdlLmRhdGEudGFza0RlZmluaXRpb24pOwogICAgICAgICAgICB0aGlzLnN0b3JlQmxvY2sobWVzc2FnZS5kYXRhLnRhc2tEZWZpbml0aW9uKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICdDYW5jZWxFZGl0aW5nQ291cnNld2FyZUJsb2NrJzoKICAgICAgICAgICAgY29uc29sZS5sb2coJ2dvdCBtZXNzYWdlIHBvc3RlZCB0byB3aW5kb3c6ICcsIG1lc3NhZ2UsICdjYW5jZWxpbmcgZWRpdGluZy4nKTsKICAgICAgICAgICAgLy8gY2xvc2UgdGhlIGVkaXQgbWVudQogICAgICAgICAgICB0aGlzLiRyZWZzLmRlZmF1bHRCbG9jay5jbG9zZUVkaXQoKTsKICAgICAgICAgICAgLy8gUmVsb2FkIHRoZSBpZnJhbWUgKHRoaXMgY2F1c2VzIHRoZSBzdGF0ZSBvZiB0aGUgYmxvY2sgdG8gcmVzZXQgdG8gaG93CiAgICAgICAgICAgIC8vIGl0IGlzIG9uIHRoZSBzZXJ2ZXIsIGRpc2NhcmRpbmcgdXNlcidzIHVuc2F2ZWQgY2hhbmdlcykuCiAgICAgICAgICAgIHRoaXMuJHJlZnMubGVybm1vZHVsZUlmcmFtZS5jb250ZW50V2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyBQYXNzIHRoZSBjaGlsZCBDb3Vyc2V3YXJlRGVmYXVsdEJsb2NrJ3MgZWRpdGluZyBzdGF0ZSBvbiB0byBvdXIgaUZyYW1lLgogICAgLy8gVGhpcyBsZXRzIG91ciBWdWUgMyBjb21wb25lbnQga25vdyB3aGV0aGVyIHRvIGhpZGUvc2hvdyBpdHMgZWRpdGluZyBVSQogICAgb25TaG93RWRpdENoYW5nZShzdGF0ZSkgewogICAgICB0aGlzLiRyZWZzLmxlcm5tb2R1bGVJZnJhbWUuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSh7CiAgICAgICAgdHlwZTogJ1Nob3dFZGl0Q2hhbmdlJywKICAgICAgICBzdGF0ZQogICAgICB9KTsKICAgIH0sCiAgICBvbklmcmFtZUxvYWQoZXZlbnQpIHsKICAgICAgY29uc29sZS5sb2coJ29uIGlmcmFtZSBsb2FkJyk7CiAgICAgIC8vIENvbmZpZ3VyZSBpRnJhbWVSZXNpemUgdG8gcmVzaXplIHRoZSBpZnJhbWUgdG8gdGhlIGhlaWdodCBvZiB0aGUKICAgICAgLy8gI2FwcCBlbGVtZW50LCB3aGljaCBpcyBtYXJrZWQgd2l0aCBkYXRhLWlmcmFtZS1oZWlnaHQsIGluc2lkZSB0aGUgaWZyYW1lCiAgICAgIGlmcmFtZVJlc2l6ZSh7CiAgICAgICAgaGVpZ2h0Q2FsY3VsYXRpb25NZXRob2Q6ICd0YWdnZWRFbGVtZW50JwogICAgICB9LCB0aGlzLiRyZWZzLmxlcm5tb2R1bGVJZnJhbWUpOwoKICAgICAgLy8gU2VuZCBtZXNzYWdlIHRvIGluaXRpYWxpemUgdGhlIFZ1ZSAzIGNvdXJzZXdhcmUgYmxvY2sncyBzdG9yZQogICAgICB0aGlzLiRyZWZzLmxlcm5tb2R1bGVJZnJhbWUuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZSh7CiAgICAgICAgdHlwZTogJ0luaXRpYWxpemVDb3Vyc2V3YXJlQmxvY2snLAogICAgICAgIC4uLndpbmRvdy5TVFVESVAuQ291cnNld2FyZUxlcm5tb2R1bGVCbG9ja3NQbHVnaW4sCiAgICAgICAgY2FuRWRpdDogdGhpcy5jYW5FZGl0LAogICAgICAgIGlzVGVhY2hlcjogdGhpcy5pc1RlYWNoZXIsCiAgICAgICAgYmxvY2s6IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5ibG9jaykpCiAgICAgIH0pOwoKICAgICAgLy8gQ2FsbCBvblNob3dFZGl0Q2hhbmdlIG9uZSB0aW1lIGFmdGVyIGxvYWQgdG8gaW5pdGlhbGl6ZSB0aGUgJ2VkaXRpbmcnCiAgICAgIC8vIHN0YXRlIGluIG91ciBWdWUgMyBjb21wb25lbnQKICAgICAgY29uc29sZS5sb2coJ2lmcmFtZSBsb2FkZWQsIGNhbGxpbmcgb25TaG93RWRpdENoYW5nZS4uLicpOwogICAgICB0aGlzLm9uU2hvd0VkaXRDaGFuZ2UodGhpcy4kcmVmcy5kZWZhdWx0QmxvY2suc2hvd0VkaXQpOwogICAgfSwKICAgIHN0b3JlQmxvY2sodGFza0RlZmluaXRpb24pIHsKICAgICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgICAuLi50aGlzLmJsb2NrLmF0dHJpYnV0ZXMsCiAgICAgICAgcGF5bG9hZDogewogICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgICAgICB0YXNrX2pzb246IHRhc2tEZWZpbml0aW9uCiAgICAgICAgfQogICAgICB9OwogICAgICB0aGlzLiRzdG9yZS5kaXNwYXRjaCgndXBkYXRlQmxvY2tJbkNvbnRhaW5lcicsIHsKICAgICAgICBhdHRyaWJ1dGVzLAogICAgICAgIGJsb2NrSWQ6IHRoaXMuYmxvY2suaWQsCiAgICAgICAgY29udGFpbmVySWQ6IHRoaXMuYmxvY2sucmVsYXRpb25zaGlwcy5jb250YWluZXIuZGF0YS5pZAogICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAvLyBjbG9zZSB0aGUgZWRpdCBtZW51CiAgICAgICAgdGhpcy4kcmVmcy5kZWZhdWx0QmxvY2suZGlzcGxheUZlYXR1cmUoZmFsc2UpOwogICAgICB9KTsKICAgIH0KICB9Cn07"},{"version":3,"names":["iframeResize","name","inject","props","block","type","Object","required","canEdit","Boolean","isTeacher","computed","iframeUrl","window","STUDIP","LernmoduleCoursewareBlocksPlugin","editorUrl","isBlockInitialized","attributes","payload","initialized","created","addEventListener","onWindowMessage","beforeDestroy","removeEventListener","methods","message","source","$refs","lernmoduleIframe","contentWindow","data","hasOwnProperty","console","log","taskDefinition","storeBlock","defaultBlock","closeEdit","location","reload","onShowEditChange","state","postMessage","onIframeLoad","event","heightCalculationMethod","CoursewareLernmoduleBlocksPlugin","JSON","parse","stringify","showEdit","task_json","$store","dispatch","blockId","id","containerId","relationships","container","then","displayFeature"],"sources":["src/components/LernmoduleCoursewareBlockBase.vue"],"sourcesContent":["<!--\nThis component embeds the Vue 3 component 'CoursewareBlock'\n(vue/src/components/CoursewareBlock.vue) using an iframe.\nThis enables us to write our Lernmodule Courseware blocks in Vue 3, although\nthe Stud.IP core is using Vue 2.\nWe resize the iframe automatically to fit its contents, and we pass messages\nback and forth with the iframe window in order to load and save the block,\nhide/show its editing UI, and so on.\n-->\n<template>\n  <component\n    class=\"cw-lernmodule-block\"\n    :is=\"coursewarePluginComponents.CoursewareDefaultBlock\"\n    ref=\"defaultBlock\"\n    :block=\"block\"\n    :canEdit=\"canEdit\"\n    :isTeacher=\"isTeacher\"\n    :preview=\"true\"\n    :defaultGrade=\"false\"\n    @storeEdit=\"storeBlock\"\n    @showEdit=\"onShowEditChange\"\n  >\n    <template #content>\n      <template v-if=\"false\">\n        <p>Lernmodule block content. Block:</p>\n        <pre style=\"font-size: 8px\">{{ block }}</pre>\n      </template>\n      <iframe\n        ref=\"lernmoduleIframe\"\n        class=\"lernmodule-iframe\"\n        :src=\"iframeUrl\"\n        @load=\"onIframeLoad\"\n      />\n    </template>\n  </component>\n</template>\n\n<style>\n.lernmodule-iframe {\n  width: 1px;\n  min-width: 100%;\n  border: none;\n}\n/* Hide CoursewareDefaultBlock's 'edit' section */\n.cw-default-block.cw-lernmodule-block .cw-block-edit {\n  display: none;\n}\n</style>\n\n<script>\nimport iframeResize from 'iframe-resizer/js/iframeResizer';\n\nexport default {\n  name: 'LernmoduleCoursewareBlockBase',\n  inject: ['coursewarePluginComponents'],\n  props: {\n    block: {\n      type: Object,\n      required: true,\n    },\n    canEdit: {\n      type: Boolean,\n      required: true,\n    },\n    isTeacher: {\n      type: Boolean,\n      required: true,\n    },\n  },\n  computed: {\n    iframeUrl() {\n      return window.STUDIP.LernmoduleCoursewareBlocksPlugin.editorUrl;\n    },\n    isBlockInitialized() {\n      return this.block.attributes.payload.initialized;\n    },\n  },\n  created() {\n    window.addEventListener('message', this.onWindowMessage);\n  },\n  beforeDestroy() {\n    window.removeEventListener('message', this.onWindowMessage);\n  },\n  methods: {\n    // Handle messages posted to our window from our iframe\n    onWindowMessage(message) {\n      if (message.source !== this.$refs.lernmoduleIframe.contentWindow) {\n        return; // Ignore the message -- it's not from our iframe\n      }\n      if (message.data && message.data.hasOwnProperty('type')) {\n        switch (message.data.type) {\n          case 'SaveCoursewareBlock':\n            console.log(\n              'got message posted to window: ',\n              message,\n              'saving courseware block. taskDefinition: ',\n              message.data.taskDefinition\n            );\n            this.storeBlock(message.data.taskDefinition);\n            break;\n          case 'CancelEditingCoursewareBlock':\n            console.log(\n              'got message posted to window: ',\n              message,\n              'canceling editing.'\n            );\n            // close the edit menu\n            this.$refs.defaultBlock.closeEdit();\n            // Reload the iframe (this causes the state of the block to reset to how\n            // it is on the server, discarding user's unsaved changes).\n            this.$refs.lernmoduleIframe.contentWindow.location.reload();\n            break;\n        }\n      }\n    },\n    // Pass the child CoursewareDefaultBlock's editing state on to our iFrame.\n    // This lets our Vue 3 component know whether to hide/show its editing UI\n    onShowEditChange(state) {\n      this.$refs.lernmoduleIframe.contentWindow.postMessage({\n        type: 'ShowEditChange',\n        state,\n      });\n    },\n    onIframeLoad(event) {\n      console.log('on iframe load');\n      // Configure iFrameResize to resize the iframe to the height of the\n      // #app element, which is marked with data-iframe-height, inside the iframe\n      iframeResize(\n        { heightCalculationMethod: 'taggedElement' },\n        this.$refs.lernmoduleIframe\n      );\n\n      // Send message to initialize the Vue 3 courseware block's store\n      this.$refs.lernmoduleIframe.contentWindow.postMessage({\n        type: 'InitializeCoursewareBlock',\n        ...window.STUDIP.CoursewareLernmoduleBlocksPlugin,\n        canEdit: this.canEdit,\n        isTeacher: this.isTeacher,\n        block: JSON.parse(JSON.stringify(this.block)),\n      });\n\n      // Call onShowEditChange one time after load to initialize the 'editing'\n      // state in our Vue 3 component\n      console.log('iframe loaded, calling onShowEditChange...');\n      this.onShowEditChange(this.$refs.defaultBlock.showEdit);\n    },\n    storeBlock(taskDefinition) {\n      const attributes = {\n        ...this.block.attributes,\n        payload: {\n          initialized: true,\n          task_json: taskDefinition,\n        },\n      };\n\n      this.$store\n        .dispatch('updateBlockInContainer', {\n          attributes,\n          blockId: this.block.id,\n          containerId: this.block.relationships.container.data.id,\n        })\n        .then(() => {\n          // close the edit menu\n          this.$refs.defaultBlock.displayFeature(false);\n        });\n    },\n  },\n};\n</script>\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA,OAAAA,YAAA;AAEA;EACAC,IAAA;EACAC,MAAA;EACAC,KAAA;IACAC,KAAA;MACAC,IAAA,EAAAC,MAAA;MACAC,QAAA;IACA;IACAC,OAAA;MACAH,IAAA,EAAAI,OAAA;MACAF,QAAA;IACA;IACAG,SAAA;MACAL,IAAA,EAAAI,OAAA;MACAF,QAAA;IACA;EACA;EACAI,QAAA;IACAC,UAAA;MACA,OAAAC,MAAA,CAAAC,MAAA,CAAAC,gCAAA,CAAAC,SAAA;IACA;IACAC,mBAAA;MACA,YAAAb,KAAA,CAAAc,UAAA,CAAAC,OAAA,CAAAC,WAAA;IACA;EACA;EACAC,QAAA;IACAR,MAAA,CAAAS,gBAAA,iBAAAC,eAAA;EACA;EACAC,cAAA;IACAX,MAAA,CAAAY,mBAAA,iBAAAF,eAAA;EACA;EACAG,OAAA;IACA;IACAH,gBAAAI,OAAA;MACA,IAAAA,OAAA,CAAAC,MAAA,UAAAC,KAAA,CAAAC,gBAAA,CAAAC,aAAA;QACA;MACA;;MACA,IAAAJ,OAAA,CAAAK,IAAA,IAAAL,OAAA,CAAAK,IAAA,CAAAC,cAAA;QACA,QAAAN,OAAA,CAAAK,IAAA,CAAA3B,IAAA;UACA;YACA6B,OAAA,CAAAC,GAAA,CACA,kCACAR,OAAA,EACA,6CACAA,OAAA,CAAAK,IAAA,CAAAI,cACA;YACA,KAAAC,UAAA,CAAAV,OAAA,CAAAK,IAAA,CAAAI,cAAA;YACA;UACA;YACAF,OAAA,CAAAC,GAAA,CACA,kCACAR,OAAA,EACA,oBACA;YACA;YACA,KAAAE,KAAA,CAAAS,YAAA,CAAAC,SAAA;YACA;YACA;YACA,KAAAV,KAAA,CAAAC,gBAAA,CAAAC,aAAA,CAAAS,QAAA,CAAAC,MAAA;YACA;QACA;MACA;IACA;IACA;IACA;IACAC,iBAAAC,KAAA;MACA,KAAAd,KAAA,CAAAC,gBAAA,CAAAC,aAAA,CAAAa,WAAA;QACAvC,IAAA;QACAsC;MACA;IACA;IACAE,aAAAC,KAAA;MACAZ,OAAA,CAAAC,GAAA;MACA;MACA;MACAnC,YAAA,CACA;QAAA+C,uBAAA;MAAA,GACA,KAAAlB,KAAA,CAAAC,gBACA;;MAEA;MACA,KAAAD,KAAA,CAAAC,gBAAA,CAAAC,aAAA,CAAAa,WAAA;QACAvC,IAAA;QACA,GAAAQ,MAAA,CAAAC,MAAA,CAAAkC,gCAAA;QACAxC,OAAA,OAAAA,OAAA;QACAE,SAAA,OAAAA,SAAA;QACAN,KAAA,EAAA6C,IAAA,CAAAC,KAAA,CAAAD,IAAA,CAAAE,SAAA,MAAA/C,KAAA;MACA;;MAEA;MACA;MACA8B,OAAA,CAAAC,GAAA;MACA,KAAAO,gBAAA,MAAAb,KAAA,CAAAS,YAAA,CAAAc,QAAA;IACA;IACAf,WAAAD,cAAA;MACA,MAAAlB,UAAA;QACA,QAAAd,KAAA,CAAAc,UAAA;QACAC,OAAA;UACAC,WAAA;UACAiC,SAAA,EAAAjB;QACA;MACA;MAEA,KAAAkB,MAAA,CACAC,QAAA;QACArC,UAAA;QACAsC,OAAA,OAAApD,KAAA,CAAAqD,EAAA;QACAC,WAAA,OAAAtD,KAAA,CAAAuD,aAAA,CAAAC,SAAA,CAAA5B,IAAA,CAAAyB;MACA,GACAI,IAAA;QACA;QACA,KAAAhC,KAAA,CAAAS,YAAA,CAAAwB,cAAA;MACA;IACA;EACA;AACA"}]}